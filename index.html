<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Century of Crisis: Millennium Dawn Redux</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- D3.js –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∏ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <!-- TopoJSON –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∫–∞—Ä—Ç—ã -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Roboto+Mono:wght@400;700&family=Special+Elite&family=Playfair+Display:wght@700&display=swap');

        :root {
            --bg-dark: #050505;
            --panel-bg: #141414;
            --border-color: #333;
            --accent-gold: #d4af37;
            --accent-red: #8a1c1c;
            --accent-green: #2d5228;
            --text-main: #e5e5e5;
            --crt-scanline: rgba(0, 0, 0, 0.5);
        }

        body, html {
            margin: 0; padding: 0;
            width: 100vw; height: 100vh;
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: 'Roboto Mono', monospace;
            overflow: hidden;
            user-select: none;
        }

        /* --- –≠–§–§–ï–ö–¢–´ –ú–û–ù–ò–¢–û–†–ê (CRT) --- */
        .crt-overlay {
            position: fixed; inset: 0; pointer-events: none; z-index: 9000;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%),
                        linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
            background-size: 100% 3px, 3px 100%;
            opacity: 0.4;
            box-shadow: inset 0 0 150px rgba(0,0,0,0.8);
        }

        .scanline {
            width: 100%; height: 5px;
            background: rgba(255,255,255,0.03);
            position: absolute; top: 0; left: 0;
            animation: scan 8s linear infinite;
            pointer-events: none; z-index: 9001;
        }

        @keyframes scan { 0% {top: -5%;} 100% {top: 105%;} }

        /* --- –ò–ù–¢–ï–†–§–ï–ô–° (UI) --- */
        .iron-panel {
            background: #1a1a1a;
            background-image: url("data:image/svg+xml,%3Csvg width='6' height='6' viewBox='0 0 6 6' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23222222' fill-opacity='0.4' fill-rule='evenodd'%3E%3Cpath d='M5 0h1L0 6V5zM6 5v1H5z'/%3E%3C/g%3E%3C/svg%3E");
            border: 1px solid #444;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
            position: relative;
        }
        
        .header-font { font-family: 'Black Ops One', cursive; letter-spacing: 1.5px; }
        .typewriter { font-family: 'Special Elite', cursive; }
        .serif-font { font-family: 'Playfair Display', serif; }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn-main {
            background: linear-gradient(180deg, #2a2a2a 0%, #111 100%);
            border: 1px solid #555;
            color: #ccc;
            text-transform: uppercase;
            font-weight: bold;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
            display: flex; align-items: center; justify-content: center;
        }
        .btn-main:hover:not(:disabled) {
            border-color: var(--accent-gold); color: #fff;
            background: linear-gradient(180deg, #333 0%, #1a1a1a 100%);
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.2);
        }
        .btn-main:active:not(:disabled) { transform: translateY(1px); }
        .btn-main:disabled { opacity: 0.4; cursor: not-allowed; filter: grayscale(1); }
        
        .btn-war { border-color: #8a1c1c; color: #ffcccc; background: linear-gradient(180deg, #3d0e0e 0%, #1f0505 100%); }
        .btn-war:hover:not(:disabled) { box-shadow: 0 0 15px rgba(138, 28, 28, 0.4); border-color: #ff4444; }

        .btn-diplo { border-color: #2b4561; color: #ccdeff; background: linear-gradient(180deg, #0e1d2e 0%, #050b14 100%); }
        
        /* --- –ö–ê–†–¢–ê --- */
        .province {
            stroke: rgba(255,255,255,0.1); stroke-width: 0.3;
            fill: #1f2225; transition: fill 0.4s ease, stroke 0.2s;
        }
        .province:hover {
            stroke: #fff; stroke-width: 1.0; cursor: pointer; fill: #333;
        }
        /* –¶–≤–µ—Ç–∞ –¥–ª—è –∫–∞—Ä—Ç—ã –Ω–∞–∑–Ω–∞—á–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ D3 */

        /* –ê–Ω–∏–º–∞—Ü–∏—è –≥—Ä–∞–Ω–∏—Ü—ã –≤–æ–π–Ω—ã */
        @keyframes war-pulse { 
            0% { stroke: var(--accent-red); stroke-width: 1; stroke-opacity: 0.5; } 
            50% { stroke: #ff4444; stroke-width: 2; stroke-opacity: 1; } 
            100% { stroke: var(--accent-red); stroke-width: 1; stroke-opacity: 0.5; } 
        }
        .war-active-border {
            animation: war-pulse 1.5s infinite;
            stroke-dasharray: 4 2;
        }

        /* --- –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê --- */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            display: flex; align-items: center; justify-content: center;
            z-index: 5000; backdrop-filter: blur(8px);
        }
        .modal-content {
            background: #111; border: 1px solid #444;
            box-shadow: 0 0 60px rgba(0,0,0,1);
            display: flex; flex-direction: column;
        }
        .modal-header {
            background: linear-gradient(90deg, #000, #111);
            color: var(--accent-gold); padding: 12px 20px;
            font-family: 'Black Ops One'; font-size: 1.4rem;
            border-bottom: 1px solid #333; display: flex; justify-content: space-between;
        }

        /* --- –ü–†–û–ì–†–ï–°–° –ë–ê–†–´ --- */
        .progress-track {
            width: 100%; height: 8px; background: #000; border: 1px solid #333; margin-top: 4px;
        }
        .progress-fill {
            height: 100%; background: var(--accent-gold);
            width: 0%; transition: width 0.3s;
        }
        .fill-red { background: var(--accent-red); }
        .fill-green { background: var(--accent-green); }

        /* --- –ù–û–í–û–°–¢–ù–ê–Ø –õ–ï–ù–¢–ê --- */
        .news-ticker {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 28px;
            background: #000; border-top: 1px solid #333;
            overflow: hidden; display: flex; align-items: center; z-index: 100;
        }
        .news-item {
            white-space: nowrap; padding-left: 100%;
            animation: ticker 25s linear infinite;
            font-family: 'Special Elite'; font-size: 12px; color: #aaa;
        }
        @keyframes ticker { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        /* --- –ò–ö–û–ù–ö–ò –õ–ò–î–ï–†–û–í --- */
        .leader-portrait {
            width: 100%; height: 100%; object-fit: cover;
            filter: sepia(0.2) contrast(1.1);
        }
        .leader-placeholder {
            width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            background: #222; color: #444; font-size: 2rem;
        }

        /* –¢–∞–±—ã */
        .tab-btn {
            flex: 1; padding: 10px; background: #111; color: #666;
            border: none; border-bottom: 2px solid #222;
            cursor: pointer; font-weight: bold; font-size: 0.7rem; uppercase;
            transition: all 0.2s;
        }
        .tab-btn.active {
            color: var(--text-main); background: #1a1a1a; border-bottom-color: var(--accent-gold);
        }
    </style>
</head>
<body>

    <!-- –≠–§–§–ï–ö–¢–´ -->
    <div class="crt-overlay"></div>
    <div class="scanline"></div>

    <!-- SVG –ü–ê–¢–¢–ï–†–ù–´ (–®–¢–†–ò–•–û–í–ö–ê) -->
    <svg style="position: absolute; width: 0; height: 0;" version="1.1">
        <defs>
            <pattern id="hatch-war" patternUnits="userSpaceOnUse" width="8" height="8" patternTransform="rotate(45)">
                <rect width="4" height="8" transform="translate(0,0)" fill="#8a1c1c" opacity="0.3"></rect>
            </pattern>
            <pattern id="hatch-occupied" patternUnits="userSpaceOnUse" width="8" height="8" patternTransform="rotate(-45)">
                <rect width="4" height="8" transform="translate(0,0)" fill="#2d5228" opacity="0.4"></rect>
            </pattern>
        </defs>
    </svg>

    <!-- –≠–ö–†–ê–ù –í–´–ë–û–†–ê –°–¢–†–ê–ù–´ -->
    <div id="selection-screen" class="modal-overlay">
        <div class="modal-content" style="width: 900px; height: 650px;">
            <div class="modal-header">
                <span>–ì–ï–û–ü–û–õ–ò–¢–ò–ß–ï–°–ö–ò–ô –°–ò–ú–£–õ–Ø–¢–û–†: 2000</span>
                <span class="text-xs text-gray-500 font-mono mt-2">SYS.VER.5.0</span>
            </div>
            
            <div class="flex flex-grow overflow-hidden">
                <!-- –°–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω -->
                <div class="w-1/3 bg-black border-r border-gray-800 flex flex-col">
                    <div class="p-3 bg-gray-900 text-[10px] font-bold text-center border-b border-gray-700 text-gray-400">–í–´–ë–ï–†–ò–¢–ï –î–ï–†–ñ–ê–í–£</div>
                    <div id="country-list" class="flex-grow overflow-y-auto p-2 space-y-1">
                        <!-- JS GENERATED -->
                    </div>
                </div>
                
                <!-- –î–µ—Ç–∞–ª–∏ -->
                <div class="w-2/3 bg-[#111] p-8 flex flex-col relative">
                    <!-- –ó–∞–≥–ª—É—à–∫–∞ -->
                    <div id="select-placeholder" class="absolute inset-0 flex flex-col items-center justify-center text-gray-600 opacity-60">
                        <svg class="w-24 h-24 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 002 2h2.945M8 3.935A9 9 0 0116.5 19.065m-7.465-15.13a9 9 0 01-12.47 12.47"></path></svg>
                        <p class="text-sm font-mono uppercase">–û–∂–∏–¥–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ —Å—É–±—ä–µ–∫—Ç–∞...</p>
                    </div>

                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω–µ -->
                    <div id="select-details" class="hidden flex flex-col h-full animate-fade-in">
                        <div class="flex justify-between items-start border-b border-gray-700 pb-6 mb-6">
                            <div>
                                <h1 id="sel-name" class="text-5xl font-black text-white uppercase tracking-tighter leading-none mb-2">RUSSIA</h1>
                                <div class="flex items-center gap-2">
                                    <span id="sel-ideology" class="px-2 py-1 bg-gray-800 text-xs font-bold text-blue-400 border border-gray-600 rounded">–ê–í–¢–û–†–ò–¢–ê–†–ò–ó–ú</span>
                                    <span class="text-xs text-gray-500">–°–¶–ï–ù–ê–†–ò–ô: –ú–ò–õ–õ–ï–ù–ò–£–ú</span>
                                </div>
                            </div>
                            <div class="text-right">
                                <div id="sel-flag" class="w-20 h-14 bg-gray-700 border border-white/20 shadow-xl"></div>
                            </div>
                        </div>

                        <div class="flex gap-6 mb-6">
                            <div class="w-32 h-40 bg-gray-800 border border-gray-600 shadow-inner flex-shrink-0 relative overflow-hidden">
                                <img id="sel-leader-img" src="" class="leader-portrait hidden" alt="Leader">
                                <div id="sel-leader-placeholder" class="leader-placeholder">?</div>
                            </div>
                            <div class="flex flex-col justify-center">
                                <div class="text-[10px] text-gray-500 uppercase tracking-widest mb-1">–ì–õ–ê–í–ê –ì–û–°–£–î–ê–†–°–¢–í–ê</div>
                                <div id="sel-leader-name" class="text-2xl font-bold text-yellow-500 serif-font">Vladimir Putin</div>
                                <div id="sel-leader-desc" class="text-xs text-gray-400 mt-2 italic border-l-2 border-gray-700 pl-3">
                                    "–í—Å—Ç—É–ø–∞—è –≤ –¥–æ–ª–∂–Ω–æ—Å—Ç—å, –ª–∏–¥–µ—Ä –æ–±–µ—â–∞–µ—Ç —É–∫—Ä–µ–ø–∏—Ç—å –≤–µ—Ä—Ç–∏–∫–∞–ª—å –≤–ª–∞—Å—Ç–∏."
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4 mt-auto">
                            <div class="p-3 bg-gray-900 border border-gray-700">
                                <div class="text-[9px] text-gray-500 uppercase">–≠–ö–û–ù–û–ú–ò–ö–ê (–í–í–ü)</div>
                                <div id="sel-gdp" class="text-xl font-mono text-green-500">$260B</div>
                            </div>
                            <div class="p-3 bg-gray-900 border border-gray-700">
                                <div class="text-[9px] text-gray-500 uppercase">–í–û–û–†–£–ñ–ï–ù–ù–´–ï –°–ò–õ–´</div>
                                <div id="sel-army" class="text-xl font-mono text-red-500">1.05M</div>
                            </div>
                        </div>

                        <button onclick="startGame()" class="mt-6 w-full py-4 btn-main text-lg border-yellow-600/50 text-yellow-500 hover:text-white hover:border-yellow-500">
                            –ù–ê–ß–ê–¢–¨ –ö–ê–ú–ü–ê–ù–ò–Æ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –û–°–ù–û–í–ù–û–ô –ò–ù–¢–ï–†–§–ï–ô–° –ò–ì–†–´ -->
    <div id="game-ui" class="hidden h-screen flex flex-col">
        
        <!-- –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ -->
        <header class="h-14 iron-panel flex items-center justify-between px-4 z-50 border-b border-gray-800">
            <!-- –ò–Ω—Ñ–æ –∏–≥—Ä–æ–∫–∞ -->
            <div class="flex items-center gap-6">
                <div class="flex items-center gap-3 pr-6 border-r border-gray-700">
                    <div id="game-flag" class="w-10 h-6 bg-gray-700 border border-white/20"></div>
                    <div>
                        <div id="game-country" class="text-sm font-bold leading-none uppercase text-white">RUSSIA</div>
                        <div id="game-leader" class="text-[10px] text-yellow-600 font-bold uppercase mt-0.5">V. PUTIN</div>
                    </div>
                </div>

                <!-- –†–µ—Å—É—Ä—Å—ã -->
                <div class="flex gap-6 text-xs font-mono">
                    <div title="–ü–æ–ª–∏—Ç–∏—á–µ—Å–∫–∞—è –í–ª–∞—Å—Ç—å">
                        <span class="text-gray-500 text-[9px] uppercase block">–ü. –í–ª–∞—Å—Ç—å</span>
                        <span class="text-gray-300">üèõ</span> <span id="res-pp" class="text-white font-bold">150</span>
                    </div>
                    <div title="–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å">
                        <span class="text-gray-500 text-[9px] uppercase block">–°—Ç–∞–±.</span>
                        <span class="text-yellow-600">‚öñ</span> <span id="res-stab" class="text-white font-bold">65%</span>
                    </div>
                    <div title="–ë—é–¥–∂–µ—Ç">
                        <span class="text-gray-500 text-[9px] uppercase block">–ë—é–¥–∂–µ—Ç</span>
                        <span class="text-green-500">$</span> <span id="res-money" class="text-white font-bold">50B</span>
                    </div>
                    <div title="–ú–∏—Ä–æ–≤–æ–µ –ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ">
                        <span class="text-gray-500 text-[9px] uppercase block">–£–≥—Ä–æ–∑–∞</span>
                        <span class="text-red-600 animate-pulse">‚ò¢</span> <span id="res-tension" class="text-white font-bold">12%</span>
                    </div>
                </div>
            </div>

            <!-- –í—Ä–µ–º—è -->
            <div class="absolute left-1/2 -translate-x-1/2 top-0 h-full flex flex-col justify-center items-center">
                <div class="bg-black/60 px-6 py-1 border-x border-gray-800 text-center">
                    <div id="date-display" class="text-xl header-font text-gray-200 tracking-wider">01 –Ø–ù–í 2000</div>
                    <div class="flex justify-center gap-1 mt-0.5">
                        <button onclick="setSpeed(0)" class="text-[9px] px-2 bg-gray-800 hover:bg-gray-700 text-gray-300">||</button>
                        <button onclick="setSpeed(1)" class="text-[9px] px-2 bg-gray-800 hover:bg-gray-700 text-gray-300">></button>
                        <button onclick="setSpeed(2)" class="text-[9px] px-2 bg-gray-800 hover:bg-gray-700 text-yellow-500">>></button>
                        <button onclick="setSpeed(3)" class="text-[9px] px-2 bg-gray-800 hover:bg-gray-700 text-red-500">>>></button>
                    </div>
                </div>
            </div>

            <!-- –ú–µ–Ω—é -->
            <div>
                <button class="btn-main px-3 py-1 text-[10px]">–ù–ê–°–¢–†–û–ô–ö–ò</button>
            </div>
        </header>

        <!-- –†–ê–ë–û–ß–ê–Ø –û–ë–õ–ê–°–¢–¨ -->
        <div class="flex-grow flex relative overflow-hidden">
            
            <!-- –ö–ê–†–¢–ê -->
            <div id="map-container" class="flex-grow bg-[#0b0d10] relative">
                <svg id="game-map" class="w-full h-full cursor-crosshair"></svg>
                
                <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–∞—Ä—Ç—ã -->
                <div id="map-notifications" class="absolute top-10 left-1/2 -translate-x-1/2 flex flex-col gap-2 pointer-events-none"></div>
            </div>

            <!-- –ü–†–ê–í–ê–Ø –ü–ê–ù–ï–õ–¨ (–í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–ï) -->
            <div id="side-panel" class="w-96 iron-panel border-l border-gray-800 flex flex-col z-40 transition-transform transform translate-x-0">
                
                <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–∞–Ω–µ–ª–∏ -->
                <div class="h-12 bg-black border-b border-gray-700 flex items-center justify-between px-4">
                    <span id="panel-title" class="font-bold text-gray-300 uppercase tracking-widest">–û–ë–ó–û–† –°–¢–†–ê–ù–´</span>
                    <button onclick="closeSidePanel()" class="text-gray-500 hover:text-white">‚úï</button>
                </div>

                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –ø–∞–Ω–µ–ª–∏ -->
                <div id="panel-content" class="flex-grow overflow-y-auto p-4 space-y-4">
                    <!-- –ó–∞–≥–ª—É—à–∫–∞ –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ -->
                    <div id="panel-empty" class="text-center text-gray-600 mt-10">
                        <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω—É –Ω–∞ –∫–∞—Ä—Ç–µ<br>–¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è.</p>
                    </div>

                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ü–µ–ª–∏ -->
                    <div id="target-info" class="hidden animate-fade-in">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h2 id="tg-name" class="text-2xl font-black text-white uppercase leading-none">GERMANY</h2>
                                <div id="tg-ideology" class="text-[10px] font-bold text-blue-400 mt-1 uppercase">–î–ï–ú–û–ö–†–ê–¢–ò–Ø</div>
                            </div>
                            <div id="tg-flag" class="w-12 h-8 bg-gray-700"></div>
                        </div>

                        <!-- –õ–∏–¥–µ—Ä -->
                        <div class="bg-gray-800/50 p-2 border border-gray-700 flex gap-3 mb-4">
                            <div class="w-12 h-14 bg-gray-900 border border-gray-600 flex-shrink-0 overflow-hidden">
                                <img id="tg-leader-img" class="w-full h-full object-cover hidden" src="">
                                <div id="tg-leader-ph" class="w-full h-full flex items-center justify-center text-gray-500 text-xs">?</div>
                            </div>
                            <div class="flex flex-col justify-center">
                                <span class="text-[9px] text-gray-500 uppercase">–ì–ª–∞–≤–∞ –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–∞</span>
                                <span id="tg-leader" class="font-bold text-sm text-yellow-500 leading-tight">Name</span>
                            </div>
                        </div>

                        <!-- –û—Ç–Ω–æ—à–µ–Ω–∏—è -->
                        <div class="mb-4">
                            <div class="flex justify-between text-[10px] text-gray-400 mb-1">
                                <span>–û–¢–ù–û–®–ï–ù–ò–Ø</span>
                                <span id="tg-rel-val" class="font-bold text-white">0</span>
                            </div>
                            <div class="w-full h-1.5 bg-gray-800 rounded-full overflow-hidden">
                                <div id="tg-rel-bar" class="h-full bg-gray-500 w-1/2 transition-all duration-500"></div>
                            </div>
                        </div>

                        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                        <div class="grid grid-cols-2 gap-2 mb-6">
                            <div class="bg-black/30 p-2 border border-gray-800 text-center">
                                <div class="text-[8px] text-gray-500 uppercase">–î–ò–í–ò–ó–ò–ò</div>
                                <div id="tg-army" class="font-mono font-bold text-sm">~100K</div>
                            </div>
                            <div class="bg-black/30 p-2 border border-gray-800 text-center">
                                <div class="text-[8px] text-gray-500 uppercase">–ò–ù–î–£–°–¢–†–ò–Ø</div>
                                <div id="tg-ind" class="font-mono font-bold text-sm">54 —Ñ–±.</div>
                            </div>
                        </div>

                        <!-- –î–µ–π—Å—Ç–≤–∏—è -->
                        <div class="space-y-3">
                            <div id="war-module" class="border-t border-gray-700 pt-3">
                                <div class="text-[10px] font-bold text-red-500 uppercase mb-2">–í–û–ï–ù–ù–´–ï –î–ï–ô–°–¢–í–ò–Ø</div>
                                
                                <!-- –ö–Ω–æ–ø–∫–∞ –æ–ø—Ä–∞–≤–¥–∞–Ω–∏—è -->
                                <button id="btn-justify" onclick="startJustify()" class="w-full py-2 btn-main btn-war text-xs mb-2">
                                    –û–ü–†–ê–í–î–ê–¢–¨ –¶–ï–õ–¨ –í–û–ô–ù–´ (50 PP)
                                </button>
                                
                                <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–ø—Ä–∞–≤–¥–∞–Ω–∏—è -->
                                <div id="justify-progress" class="hidden mb-2">
                                    <div class="flex justify-between text-[9px] text-yellow-500 mb-1">
                                        <span>–§–ê–ë–†–ò–ö–ê–¶–ò–Ø CASUS BELLI...</span>
                                        <span id="justify-time">30 –¥–Ω.</span>
                                    </div>
                                    <div class="progress-track">
                                        <div id="justify-bar" class="progress-fill"></div>
                                    </div>
                                </div>

                                <!-- –ö–Ω–æ–ø–∫–∞ –≤–æ–π–Ω—ã -->
                                <button id="btn-declare-war" onclick="declareWar()" class="hidden w-full py-3 btn-main bg-red-900 border-red-500 text-white font-bold text-sm animate-pulse">
                                    –û–ë–™–Ø–í–ò–¢–¨ –í–û–ô–ù–£
                                </button>

                                <!-- –ê–∫—Ç–∏–≤–Ω–∞—è –≤–æ–π–Ω–∞ -->
                                <div id="active-war-stats" class="hidden bg-red-900/20 border border-red-900 p-2 text-center">
                                    <span class="text-xs font-bold text-red-400">–ò–î–ï–¢ –í–û–ô–ù–ê</span>
                                    <div class="progress-track mt-1 bg-black border-red-800">
                                        <div id="war-progress-bar" class="progress-fill fill-red" style="width: 0%"></div>
                                    </div>
                                    <div class="flex justify-between text-[9px] mt-1 text-gray-400 font-mono">
                                        <span>–û–ö–ö–£–ü–ê–¶–ò–Ø</span>
                                        <span id="war-score">0%</span>
                                    </div>
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-2 pt-2 border-t border-gray-700">
                                <button class="py-2 btn-main btn-diplo text-[10px]">–£–õ–£–ß–®–ò–¢–¨ –û–¢–ù.</button>
                                <button class="py-2 btn-main text-[10px]">–ê–õ–¨–Ø–ù–°</button>
                                <button class="py-2 btn-main text-[10px]">–¢–û–†–ì–û–í–õ–Ø</button>
                                <button class="py-2 btn-main text-[10px]">–®–ü–ò–û–ù–ê–ñ</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ù–û–í–û–°–¢–ù–ê–Ø –õ–ï–ù–¢–ê -->
        <div class="news-ticker">
            <div class="bg-red-900 text-white px-3 text-[10px] font-bold h-full flex items-center z-10 shadow-lg">–ú–ò–†–û–í–´–ï –ù–û–í–û–°–¢–ò</div>
            <div id="news-feed" class="news-item">
                +++ 2000 –ì–û–î –ù–ê–°–¢–£–ü–ò–õ +++ –ú–ò–õ–õ–ï–ù–ò–£–ú: –ú–ò–† –í –û–ñ–ò–î–ê–ù–ò–ò –ü–ï–†–ï–ú–ï–ù +++ –ù–ï–§–¢–Ø–ù–´–ï –ö–û–¢–ò–†–û–í–ö–ò –†–ê–°–¢–£–¢ +++
            </div>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –°–û–ë–´–¢–ò–ô -->
    <div id="event-modal" class="modal-overlay hidden">
        <div class="modal-content w-[500px]">
            <div class="modal-header border-b-0">
                <span class="text-red-500">–°–†–û–ß–ù–û–ï –°–û–û–ë–©–ï–ù–ò–ï</span>
            </div>
            <div class="p-6 bg-[#0a0a0a]">
                <div class="flex gap-4 mb-4">
                    <div class="w-1/4 h-24 bg-gray-800 border border-gray-600 flex items-center justify-center text-4xl">‚ö†</div>
                    <div class="w-3/4">
                        <h3 id="ev-title" class="text-xl font-bold text-white mb-2 serif-font">–¢–ï–†–ê–ö–¢ –í –°–¢–û–õ–ò–¶–ï</h3>
                        <p id="ev-desc" class="text-xs text-gray-400 leading-relaxed typewriter">
                            –°—Ä–æ—á–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏: –≤ —Ü–µ–Ω—Ç—Ä–µ —Å—Ç–æ–ª–∏—Ü—ã –ø—Ä–æ–≥—Ä–µ–º–µ–ª –≤–∑—Ä—ã–≤. –°–ª—É–∂–±—ã —Å–ø–∞—Å–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ –º–µ—Å—Ç–µ. –û–±—â–µ—Å—Ç–≤–æ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–≤–µ—Ç–∞.
                        </p>
                    </div>
                </div>
                <div id="ev-options" class="space-y-2">
                    <!-- –ö–Ω–æ–ø–∫–∏ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- –ë–ê–ó–ê –î–ê–ù–ù–´–• (DB) ---
        const CONFIG = {
            START_YEAR: 2000,
            END_YEAR: 2222
        };

        // –†—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–ª—è –∫–∞—Ä—Ç—ã (GeoJSON –æ–±—ã—á–Ω–æ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º)
        const TRANSLATIONS = {
            "Russia": "–†–æ—Å—Å–∏—è", "United States of America": "–°–®–ê", "China": "–ö–∏—Ç–∞–π", "Germany": "–ì–µ—Ä–º–∞–Ω–∏—è", "France": "–§—Ä–∞–Ω—Ü–∏—è",
            "Ukraine": "–£–∫—Ä–∞–∏–Ω–∞", "United Kingdom": "–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è", "Poland": "–ü–æ–ª—å—à–∞", "Italy": "–ò—Ç–∞–ª–∏—è", "Spain": "–ò—Å–ø–∞–Ω–∏—è",
            "Turkey": "–¢—É—Ä—Ü–∏—è", "Iran": "–ò—Ä–∞–Ω", "Japan": "–Ø–ø–æ–Ω–∏—è", "South Korea": "–Æ–∂–Ω–∞—è –ö–æ—Ä–µ—è", "North Korea": "–ö–ù–î–†",
            "India": "–ò–Ω–¥–∏—è", "Brazil": "–ë—Ä–∞–∑–∏–ª–∏—è", "Canada": "–ö–∞–Ω–∞–¥–∞", "Australia": "–ê–≤—Å—Ç—Ä–∞–ª–∏—è", "Kazakhstan": "–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω",
            "Belarus": "–ë–µ–ª–∞—Ä—É—Å—å", "Finland": "–§–∏–Ω–ª—è–Ω–¥–∏—è", "Sweden": "–®–≤–µ—Ü–∏—è", "Norway": "–ù–æ—Ä–≤–µ–≥–∏—è"
        };

        const DB = {
            'RUS': { 
                name: '–†–æ—Å—Å–∏—è', 
                color: '#4a6b4a', 
                ideology: '–ê–≤—Ç–æ—Ä–∏—Ç–∞—Ä–∏–∑–º',
                gdp: 260, 
                army: 1000,
                leaders: [
                    { start: 2000, end: 2008, name: '–í–ª–∞–¥–∏–º–∏—Ä –ü—É—Ç–∏–Ω', img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/15/Vladimir_Putin_-_2000-11-15.jpg/220px-Vladimir_Putin_-_2000-11-15.jpg' },
                    { start: 2008, end: 2012, name: '–î–º–∏—Ç—Ä–∏–π –ú–µ–¥–≤–µ–¥–µ–≤', img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/b8/Dmitry_Medvedev_2011.jpg/220px-Dmitry_Medvedev_2011.jpg' },
                    { start: 2012, end: 2036, name: '–í–ª–∞–¥–∏–º–∏—Ä –ü—É—Ç–∏–Ω', img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/c/c2/Vladimir_Putin_2024.jpg/220px-Vladimir_Putin_2024.jpg' }
                ]
            },
            'USA': { 
                name: '–°–®–ê', 
                color: '#2b3b55', 
                ideology: '–î–µ–º–æ–∫—Ä–∞—Ç–∏—è',
                gdp: 10200, 
                army: 1400,
                leaders: [
                    { start: 2000, end: 2001, name: '–ë–∏–ª–ª –ö–ª–∏–Ω—Ç–æ–Ω', img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/d/d3/Bill_Clinton.jpg/220px-Bill_Clinton.jpg' },
                    { start: 2001, end: 2009, name: '–î–∂–æ—Ä–¥–∂ –ë—É—à –º–ª.', img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/George-W-Bush.jpeg/220px-George-W-Bush.jpeg' },
                    { start: 2009, end: 2017, name: '–ë–∞—Ä–∞–∫ –û–±–∞–º–∞', img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/8d/President_Barack_Obama.jpg/220px-President_Barack_Obama.jpg' },
                    { start: 2017, end: 2021, name: '–î–æ–Ω–∞–ª—å–¥ –¢—Ä–∞–º–ø', img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/56/Donald_Trump_official_portrait.jpg/220px-Donald_Trump_official_portrait.jpg' },
                    { start: 2021, end: 2025, name: '–î–∂–æ –ë–∞–π–¥–µ–Ω', img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/68/Joe_Biden_presidential_portrait.jpg/220px-Joe_Biden_presidential_portrait.jpg' },
                    { start: 2025, end: 2029, name: '–î–æ–Ω–∞–ª—å–¥ –¢—Ä–∞–º–ø', img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/56/Donald_Trump_official_portrait.jpg/220px-Donald_Trump_official_portrait.jpg' }
                ]
            },
            'CHN': {
                name: '–ö–∏—Ç–∞–π',
                color: '#8c7e38',
                ideology: '–ö–æ–º–º—É–Ω–∏–∑–º',
                gdp: 1200,
                army: 2000,
                leaders: [
                    { start: 2000, end: 2003, name: '–¶–∑—è–Ω –¶–∑—ç–º–∏–Ω—å', img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/65/Jiang_Zemin_2002.jpg/220px-Jiang_Zemin_2002.jpg' },
                    { start: 2003, end: 2013, name: '–•—É –¶–∑–∏–Ω—å—Ç–∞–æ', img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/6f/Hu_Jintao_2011.jpg/220px-Hu_Jintao_2011.jpg' },
                    { start: 2013, end: 2040, name: '–°–∏ –¶–∑–∏–Ω—å–ø–∏–Ω', img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/3d/Xi_Jinping_2019.jpg/220px-Xi_Jinping_2019.jpg' }
                ]
            },
            'DEU': {
                name: '–ì–µ—Ä–º–∞–Ω–∏—è',
                color: '#444',
                ideology: '–î–µ–º–æ–∫—Ä–∞—Ç–∏—è',
                gdp: 1900,
                army: 300,
                leaders: [
                    { start: 1998, end: 2005, name: '–ì–µ—Ä—Ö–∞—Ä–¥ –®—Ä—ë–¥–µ—Ä', img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/4b/Gerhard_Schroeder_2005.jpg/220px-Gerhard_Schroeder_2005.jpg' },
                    { start: 2005, end: 2021, name: '–ê–Ω–≥–µ–ª–∞ –ú–µ—Ä–∫–µ–ª—å', img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/b6/Besuch_Bundeskanzlerin_Angela_Merkel_im_Rathaus_K%C3%B6ln-09916.jpg/220px-Besuch_Bundeskanzlerin_Angela_Merkel_im_Rathaus_K%C3%B6ln-09916.jpg' },
                    { start: 2021, end: 2025, name: '–û–ª–∞—Ñ –®–æ–ª—å—Ü', img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/8c/2021_Olaf_Scholz_%28cropped%29.jpg/220px-2021_Olaf_Scholz_%28cropped%29.jpg' },
                    { start: 2025, end: 2030, name: '–§—Ä–∏–¥—Ä–∏—Ö –ú–µ—Ä—Ü', img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/07/2024-05-07_CDU_CSU_Fraktionssitzung_Bundestag_by_Olaf_Kosinsky_0396.jpg/220px-2024-05-07_CDU_CSU_Fraktionssitzung_Bundestag_by_Olaf_Kosinsky_0396.jpg' }
                ]
            },
            'UKR': {
                name: '–£–∫—Ä–∞–∏–Ω–∞',
                color: '#3d6e8a',
                ideology: '–î–µ–º–æ–∫—Ä–∞—Ç–∏—è',
                gdp: 32,
                army: 200,
                leaders: [
                    { start: 2000, end: 2005, name: '–õ–µ–æ–Ω–∏–¥ –ö—É—á–º–∞', img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/00/Leonid_Kuchma_2003.jpg/220px-Leonid_Kuchma_2003.jpg' },
                    { start: 2005, end: 2010, name: '–í–∏–∫—Ç–æ—Ä –Æ—â–µ–Ω–∫–æ', img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/30/Yushchenko.jpg/220px-Yushchenko.jpg' },
                    { start: 2010, end: 2014, name: '–í–∏–∫—Ç–æ—Ä –Ø–Ω—É–∫–æ–≤–∏—á', img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/4f/Viktor_Yanukovych_2011-09-08.jpg/220px-Viktor_Yanukovych_2011-09-08.jpg' },
                    { start: 2014, end: 2019, name: '–ü–µ—Ç—Ä –ü–æ—Ä–æ—à–µ–Ω–∫–æ', img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/3d/Official_portrait_of_Petro_Poroshenko.jpg/220px-Official_portrait_of_Petro_Poroshenko.jpg' },
                    { start: 2019, end: 2030, name: '–í–ª–∞–¥–∏–º–∏—Ä –ó–µ–ª–µ–Ω—Å–∫–∏–π', img: 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/9c/Volodymyr_Zelensky_Official_portrait.jpg/220px-Volodymyr_Zelensky_Official_portrait.jpg' }
                ]
            }
        };

        const EVENTS = [
            {
                title: "–ö–†–ê–• –§–û–ù–î–û–í–û–ì–û –†–´–ù–ö–ê",
                desc: "–ì–ª–æ–±–∞–ª—å–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏–∫–∞ –≤ —Ä–µ—Ü–µ—Å—Å–∏–∏. –ò–Ω–¥–µ–∫—Å—ã –ø–∞–¥–∞—é—Ç.",
                options: [
                    { text: "–°–ø–∞—Å—Ç–∏ –±–∞–Ω–∫–∏ (–ë—é–¥–∂–µ—Ç -5B)", effect: (s) => s.money -= 5 },
                    { text: "–ü—É—Å—Ç—å –≤—ã–∂–∏–≤–∞—é—Ç —Å–∏–ª—å–Ω–µ–π—à–∏–µ (–°—Ç–∞–± -10%)", effect: (s) => s.stab -= 10 }
                ]
            },
            {
                title: "–ü–ê–ù–î–ï–ú–ò–Ø",
                desc: "–ù–æ–≤—ã–π –≤–∏—Ä—É—Å —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ –º–∏—Ä—É.",
                options: [
                    { text: "–í–≤–µ—Å—Ç–∏ –ª–æ–∫–¥–∞—É–Ω (–≠–∫–æ–Ω–æ–º–∏–∫–∞ -10%)", effect: (s) => s.money *= 0.9 },
                    { text: "–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å (–°—Ç–∞–± -15%)", effect: (s) => s.stab -= 15 }
                ]
            },
            {
                title: "–¢–ï–†–ê–ö–¢",
                desc: "–ê—Ç–∞–∫–∞ –Ω–∞ –≥—Ä–∞–∂–¥–∞–Ω—Å–∫–∏–π –æ–±—ä–µ–∫—Ç. –°—Ç—Ä–∞–Ω–∞ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–º—â–µ–Ω–∏—è.",
                options: [
                    { text: "–£—Å–∏–ª–∏—Ç—å –æ—Ö—Ä–∞–Ω—É (–ü.–í–ª–∞—Å—Ç—å -20)", effect: (s) => s.pp -= 20 },
                    { text: "–ù–∞–π—Ç–∏ –≤–∏–Ω–æ–≤–Ω—ã—Ö (–ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ +5%)", effect: (s) => document.getElementById('res-tension').innerText = (parseInt(document.getElementById('res-tension').innerText)+5) + '%' }
                ]
            }
        ];

        // –ò–º–µ–Ω–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ (2030+)
        const GEN_NAMES = ["–ê–ª–µ–∫—Å", "–î–∂–æ–Ω", "–õ–∏", "–•–∞–Ω—Å", "–ú–∞—Ä–∏—è", "–ï–ª–µ–Ω–∞", "–î—ç–≤–∏–¥", "–°–∞—Ä–∞", "–í–∏–∫—Ç–æ—Ä", "–û–ª—å–≥–∞"];
        const GEN_SURNAMES = ["–ü—Ä–∞–π–º", "–ù–æ–≤–∞", "–°–º–∏—Ç", "–ò–≤–∞–Ω–æ–≤", "–ß–µ–Ω", "–ú—é–ª–ª–µ—Ä", "–ü–µ—Ç—Ä–æ–≤", "–í—É", "–°–∏–ª—å–≤–µ—Ä", "–®—Ç–æ–ª—å—Ü"];

        // --- –ì–õ–û–ë–ê–õ–¨–ù–û–ï –°–û–°–¢–û–Ø–ù–ò–ï ---
        let state = {
            player: null, // ID —Å—Ç—Ä–∞–Ω—ã –∏–≥—Ä–æ–∫–∞
            target: null, // ID –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω—ã
            date: new Date(2000, 0, 1),
            speed: 0,
            countries: [], // –ú–∞—Å—Å–∏–≤ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω (GeoJSON + –¥–∞–Ω–Ω—ã–µ)
            resources: { pp: 200, stab: 70, money: 50 },
            justifications: {}, // { targetId: { progress: 0 } }
            wars: {} // { targetId: { progress: 0 } }
        };

        let intervalId = null;

        // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
        window.onload = async () => {
            await initMap();
            renderCountryList();
        };

        async function initMap() {
            const svg = d3.select("#game-map");
            const width = window.innerWidth;
            const height = window.innerHeight;

            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞–¥–µ–∂–Ω—ã–π CDN –¥–ª—è TopoJSON (–º–µ–Ω—å—à–µ –≤–µ—Å, –Ω–∞–¥–µ–∂–Ω–µ–µ)
            try {
                const response = await fetch('https://cdn.jsdelivr.net/npm/world-atlas@2.0.2/countries-110m.json');
                const world = await response.json();
                
                // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è TopoJSON –≤ GeoJSON
                const features = topojson.feature(world, world.objects.countries).features;

                state.countries = features.map(f => {
                    const engName = f.properties.name;
                    // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –∫–æ–¥ —Å—Ç—Ä–∞–Ω—ã –ø–æ –∏–º–µ–Ω–∏ (—É–ø—Ä–æ—â–µ–Ω–Ω–æ)
                    let id = "UNK";
                    
                    // –ü—Ä–æ—Å—Ç–æ–π –º–∞–ø–ø–∏–Ω–≥ –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ç—Ä–∞–Ω, —á—Ç–æ–±—ã —Å–≤—è–∑–∞—Ç—å —Å DB
                    if(engName === "Russia") id = "RUS";
                    else if(engName === "United States of America") id = "USA";
                    else if(engName === "China") id = "CHN";
                    else if(engName === "Germany") id = "DEU";
                    else if(engName === "Ukraine") id = "UKR";
                    else id = engName.substring(0, 3).toUpperCase();

                    const dbEntry = DB[id] || { 
                        name: TRANSLATIONS[engName] || engName, // –ü–µ—Ä–µ–≤–æ–¥ –∏–ª–∏ –æ—Ä–∏–≥–∏–Ω–∞–ª
                        color: '#2a2a2a', 
                        ideology: '–ù–µ–π—Ç—Ä–∞–ª–∏—Ç–µ—Ç', 
                        gdp: (Math.random() * 100).toFixed(0),
                        army: (Math.random() * 200).toFixed(0),
                        leaders: []
                    };

                    return {
                        id: id,
                        geo: f,
                        ...dbEntry,
                        currentLeader: getLeader(dbEntry.leaders, 2000),
                        relation: 0
                    };
                });

                // –û—Ç—Ä–∏—Å–æ–≤–∫–∞
                const projection = d3.geoNaturalEarth1().scale(width / 5.5).translate([width/2.1, height/2]);
                const path = d3.geoPath().projection(projection);

                svg.append("g")
                    .selectAll("path")
                    .data(state.countries)
                    .enter()
                    .append("path")
                    .attr("d", path)
                    .attr("class", "province")
                    .attr("id", d => `c-${d.id}`)
                    .attr("fill", d => d.color) // –ò–∑–Ω–∞—á–∞–ª—å–Ω—ã–π —Ü–≤–µ—Ç –∏–∑ –±–∞–∑—ã
                    .on("click", (e, d) => onCountryClick(d));

                // –ó—É–º
                const zoom = d3.zoom()
                    .scaleExtent([1, 8])
                    .on("zoom", (e) => svg.select("g").attr("transform", e.transform));
                svg.call(zoom);

            } catch (err) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã:", err);
                alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ä—Ç—É –º–∏—Ä–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.");
            }
        }

        // --- –õ–û–ì–ò–ö–ê –í–´–ë–û–†–ê –°–¢–†–ê–ù–´ ---
        function renderCountryList() {
            const list = document.getElementById('country-list');
            // –°–Ω–∞—á–∞–ª–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–ø–∏—Å–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω—ã
            const majors = state.countries.filter(c => DB[c.id]);
            
            majors.forEach(c => {
                const div = document.createElement('div');
                div.className = "p-2 bg-gray-800 border border-gray-700 hover:bg-gray-700 cursor-pointer flex justify-between items-center text-gray-300 hover:text-white transition";
                div.innerHTML = `<span class="font-bold text-xs">${c.name}</span> <span class="text-[9px] text-gray-500">${c.ideology}</span>`;
                div.onclick = () => selectCountryPreview(c);
                list.appendChild(div);
            });
        }

        function selectCountryPreview(c) {
            document.getElementById('select-placeholder').classList.add('hidden');
            document.getElementById('select-details').classList.remove('hidden');
            
            document.getElementById('sel-name').innerText = c.name;
            document.getElementById('sel-ideology').innerText = c.ideology;
            document.getElementById('sel-gdp').innerText = `$${c.gdp}B`;
            document.getElementById('sel-army').innerText = `${c.army}K`;
            
            // –õ–∏–¥–µ—Ä
            const leader = c.currentLeader;
            document.getElementById('sel-leader-name').innerText = leader.name;
            
            const img = document.getElementById('sel-leader-img');
            const ph = document.getElementById('sel-leader-placeholder');
            
            if (leader.img) {
                img.src = leader.img;
                img.classList.remove('hidden');
                ph.classList.add('hidden');
            } else {
                img.classList.add('hidden');
                ph.classList.remove('hidden');
            }

            state.tempPlayer = c.id;
        }

        function startGame() {
            if (!state.tempPlayer) return;
            state.player = state.tempPlayer;
            
            document.getElementById('selection-screen').style.display = 'none';
            document.getElementById('game-ui').classList.remove('hidden');
            
            updateTopBar();
            
            // –†–∞—Å–∫—Ä–∞—Å–∫–∞ –∫–∞—Ä—Ç—ã: –ò–≥—Ä–æ–∫ –∑–µ–ª–µ–Ω—ã–π, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–µ—Ñ–æ–ª—Ç
            d3.selectAll('.province')
                .attr('fill', d => d.id === state.player ? '#2d5228' : '#2a2a2a');
                
            addNews("–î–û–ë–†–û –ü–û–ñ–ê–õ–û–í–ê–¢–¨, –ö–û–ú–ê–ù–î–£–Æ–©–ò–ô. 2000 –ì–û–î –ù–ê–°–¢–£–ü–ò–õ.");
        }

        // --- –ò–ì–†–û–í–û–ô –¶–ò–ö–õ ---
        function setSpeed(s) {
            state.speed = s;
            if (intervalId) clearInterval(intervalId);
            if (s > 0) {
                const ms = s === 1 ? 1000 : (s === 2 ? 200 : 50);
                intervalId = setInterval(gameTick, ms);
            }
        }

        function gameTick() {
            // –í—Ä–µ–º—è
            state.date.setDate(state.date.getDate() + 1);
            updateDateUI();

            // –†–µ—Å—É—Ä—Å—ã
            state.resources.pp += 0.5;
            state.resources.money += 0.1;
            updateTopBar();

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–¥–µ—Ä–æ–≤ (1 —á–∏—Å–ª–æ –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞)
            if (state.date.getDate() === 1) {
                checkLeaders();
                
                // –°–ª—É—á–∞–π–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
                if (Math.random() < 0.05) triggerEvent();
            }

            // –í–æ–π–Ω—ã –∏ –æ–ø—Ä–∞–≤–¥–∞–Ω–∏—è
            processWars();
        }

        function updateDateUI() {
            const months = ["–Ø–ù–í", "–§–ï–í", "–ú–ê–†", "–ê–ü–†", "–ú–ê–ô", "–ò–Æ–ù", "–ò–Æ–õ", "–ê–í–ì", "–°–ï–ù", "–û–ö–¢", "–ù–û–Ø", "–î–ï–ö"];
            const d = state.date;
            document.getElementById('date-display').innerText = `${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear()}`;
        }

        function updateTopBar() {
            const p = state.countries.find(c => c.id === state.player);
            if (!p) return;
            
            document.getElementById('game-country').innerText = p.name;
            document.getElementById('game-leader').innerText = p.currentLeader.name;
            
            document.getElementById('res-pp').innerText = Math.floor(state.resources.pp);
            document.getElementById('res-stab').innerText = Math.floor(state.resources.stab) + '%';
            document.getElementById('res-money').innerText = Math.floor(state.resources.money) + 'B';
        }

        // --- –õ–ò–î–ï–†–´ –ò –ì–ï–ù–ï–†–ê–¶–ò–Ø ---
        function getLeader(history, year) {
            if (!history || history.length === 0) return { name: "–í—Ä–µ–º–µ–Ω–Ω–æ–µ –ü—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ", img: null };
            
            const historical = history.find(l => year >= l.start && year < l.end);
            if (historical) return historical;
            
            // –ï—Å–ª–∏ –≥–æ–¥ –±–æ–ª—å—à–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º
            if (year > 2026) {
                return { name: generateName(), img: null };
            }
            
            return { name: "–°–æ–≤–µ—Ç –ú–∏–Ω–∏—Å—Ç—Ä–æ–≤", img: null };
        }

        function checkLeaders() {
            const year = state.date.getFullYear();
            
            state.countries.forEach(c => {
                const newLeader = getLeader(c.leaders, year);
                
                // –ï—Å–ª–∏ —ç—Ç–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ª–∏–¥–µ—Ä, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –µ–≥–æ, —á—Ç–æ–±—ã –Ω–µ –º–µ–Ω—è–ª—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
                if (year > 2026 && (!c.generatedLeader || Math.random() < 0.01)) { // –†–∞–∑ –≤ —Å—Ç–æ –ª–µ—Ç –∏–ª–∏ –µ—Å–ª–∏ –Ω–µ—Ç
                     c.generatedLeader = newLeader;
                     c.currentLeader = newLeader;
                } else if (year <= 2026) {
                    // –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π
                    if (newLeader.name !== c.currentLeader.name) {
                        c.currentLeader = newLeader;
                        if (c.id === state.player) {
                            addNews(`–°–†–û–ß–ù–û: –í —Å—Ç—Ä–∞–Ω–µ ${c.name} –Ω–æ–≤—ã–π –ª–∏–¥–µ—Ä - ${newLeader.name}`);
                            updateTopBar();
                        }
                    }
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞–Ω–µ–ª—å –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–∞
            if (state.target) openSidePanel(state.countries.find(c => c.id === state.target));
        }

        function generateName() {
            const name = GEN_NAMES[Math.floor(Math.random() * GEN_NAMES.length)];
            const surname = GEN_SURNAMES[Math.floor(Math.random() * GEN_SURNAMES.length)];
            return `${name} ${surname}`;
        }

        // --- –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–ï ---
        function onCountryClick(d) {
            if (d.id === state.player) return;
            state.target = d.id;
            openSidePanel(d);
        }

        function openSidePanel(d) {
            const panel = document.getElementById('side-panel');
            panel.style.transform = "translateX(0)"; // –ü–æ–∫–∞–∑–∞—Ç—å
            
            document.getElementById('panel-empty').classList.add('hidden');
            document.getElementById('target-info').classList.remove('hidden');
            
            document.getElementById('tg-name').innerText = d.name;
            document.getElementById('tg-ideology').innerText = d.ideology;
            document.getElementById('tg-army').innerText = `~${d.army}K`;
            document.getElementById('tg-ind').innerText = `${Math.floor(d.gdp / 10)} —Ñ–±.`;
            
            // –õ–∏–¥–µ—Ä
            document.getElementById('tg-leader').innerText = d.currentLeader.name;
            const img = document.getElementById('tg-leader-img');
            const ph = document.getElementById('tg-leader-ph');
            if (d.currentLeader.img) {
                img.src = d.currentLeader.img;
                img.classList.remove('hidden');
                ph.classList.add('hidden');
            } else {
                img.classList.add('hidden');
                ph.classList.remove('hidden');
            }

            // –û—Ç–Ω–æ—à–µ–Ω–∏—è
            const rel = d.relation || 0;
            document.getElementById('tg-rel-val').innerText = rel;
            document.getElementById('tg-rel-bar').style.width = (rel + 50) + '%';
            if (rel > 0) document.getElementById('tg-rel-bar').style.backgroundColor = '#2d5228';
            else document.getElementById('tg-rel-bar').style.backgroundColor = '#8a1c1c';

            updateWarUI();
        }

        function closeSidePanel() {
            document.getElementById('side-panel').style.transform = "translateX(100%)";
            state.target = null;
        }

        // --- –í–û–ô–ù–ê –ò –ú–ò–† ---
        function updateWarUI() {
            const tId = state.target;
            const just = state.justifications[tId];
            const war = state.wars[tId];

            document.getElementById('justify-progress').classList.add('hidden');
            document.getElementById('btn-declare-war').classList.add('hidden');
            document.getElementById('active-war-stats').classList.add('hidden');
            document.getElementById('btn-justify').disabled = false;
            document.getElementById('btn-justify').innerText = "–û–ü–†–ê–í–î–ê–¢–¨ –¶–ï–õ–¨ –í–û–ô–ù–´ (50 PP)";

            if (war) {
                document.getElementById('btn-justify').classList.add('hidden');
                document.getElementById('active-war-stats').classList.remove('hidden');
                document.getElementById('war-progress-bar').style.width = war.progress + '%';
                document.getElementById('war-score').innerText = Math.floor(war.progress) + '%';
            } else if (just) {
                if (just.ready) {
                    document.getElementById('btn-justify').classList.add('hidden');
                    document.getElementById('btn-declare-war').classList.remove('hidden');
                } else {
                    document.getElementById('btn-justify').disabled = true;
                    document.getElementById('btn-justify').innerText = "–§–ê–ë–†–ò–ö–ê–¶–ò–Ø...";
                    document.getElementById('justify-progress').classList.remove('hidden');
                    document.getElementById('justify-bar').style.width = just.progress + '%';
                    document.getElementById('justify-time').innerText = Math.ceil(30 - (just.progress * 0.3)) + ' –¥–Ω.';
                }
            } else {
                document.getElementById('btn-justify').classList.remove('hidden');
            }
        }

        function startJustify() {
            if (state.resources.pp < 50) {
                alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–æ–π –≤–ª–∞—Å—Ç–∏!");
                return;
            }
            state.resources.pp -= 50;
            updateTopBar();
            
            state.justifications[state.target] = { progress: 0, ready: false };
            updateWarUI();
        }

        function declareWar() {
            const tId = state.target;
            delete state.justifications[tId]; // –£–¥–∞–ª—è–µ–º —Ü–µ–ª—å
            state.wars[tId] = { progress: 0 };
            
            // –í–∏–∑—É–∞–ª –Ω–∞ –∫–∞—Ä—Ç–µ
            d3.select(`#c-${tId}`).classed('war-active-border', true);
            d3.select(`#c-${tId}`).style('fill', 'url(#hatch-war) #333');
            
            addNews(`–í–û–ô–ù–ê! ${state.countries.find(c=>c.id==state.player).name} –û–ë–™–Ø–í–õ–Ø–ï–¢ –í–û–ô–ù–£ ${state.countries.find(c=>c.id==tId).name}!`);
            updateWarUI();
        }

        function processWars() {
            // –û–ø—Ä–∞–≤–¥–∞–Ω–∏—è
            for (let tId in state.justifications) {
                const j = state.justifications[tId];
                if (!j.ready) {
                    j.progress += 2; // –°–∫–æ—Ä–æ—Å—Ç—å –æ–ø—Ä–∞–≤–¥–∞–Ω–∏—è
                    if (j.progress >= 100) {
                        j.ready = true;
                        addNews(`–¶–ï–õ–¨ –í–û–ô–ù–´ –ü–†–û–¢–ò–í ${tId} –ì–û–¢–û–í–ê!`);
                    }
                    if (state.target === tId) updateWarUI();
                }
            }

            // –ê–∫—Ç–∏–≤–Ω—ã–µ –≤–æ–π–Ω—ã
            for (let tId in state.wars) {
                const w = state.wars[tId];
                // –õ–æ–≥–∏–∫–∞ –±–∏—Ç–≤—ã (—Ä–∞–Ω–¥–æ–º + –∞—Ä–º–∏—è)
                const playerC = state.countries.find(c => c.id === state.player);
                const enemyC = state.countries.find(c => c.id === tId);
                
                // –ü—Ä–æ—Å—Ç–æ–π —Ä–∞—Å—á–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                let gain = 0.2; // –ë–∞–∑–∞
                if (parseInt(playerC.army) > parseInt(enemyC.army)) gain += 0.3;
                
                w.progress += gain;
                if (w.progress >= 100) {
                    // –ü–æ–±–µ–¥–∞
                    w.progress = 100;
                    countryCapitulated(tId);
                }
                if (state.target === tId) updateWarUI();
            }
        }

        function countryCapitulated(tId) {
            delete state.wars[tId];
            addNews(`–ü–û–ë–ï–î–ê! ${tId} –ö–ê–ü–ò–¢–£–õ–ò–†–û–í–ê–õ–ê.`);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç—É
            const el = d3.select(`#c-${tId}`);
            el.classed('war-active-border', false);
            el.style('fill', 'url(#hatch-occupied) #2d5228'); // –ó–∞—à—Ç—Ä–∏—Ö–æ–≤–∞–Ω–Ω—ã–π –∑–µ–ª–µ–Ω—ã–π
            
            if (state.target === tId) closeSidePanel();
        }

        // --- –°–û–ë–´–¢–ò–Ø ---
        function triggerEvent() {
            const events = [
                { t: "–¢–ï–†–ê–ö–¢ –í –ú–ï–¢–†–û", d: "–ì—Ä—É–ø–ø–∞ —Ä–∞–¥–∏–∫–∞–ª–æ–≤ —Å–æ–≤–µ—Ä—à–∏–ª–∞ –Ω–∞–ø–∞–¥–µ–Ω–∏–µ. –ù–∞—Ä–æ–¥ —Ç—Ä–µ–±—É–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.", opts: [{t:"–£—Å–∏–ª–∏—Ç—å –æ—Ö—Ä–∞–Ω—É (-20 PP)", eff:()=>{state.resources.pp-=20}}, {t:"–°–∫—Ä—ã—Ç—å –¥–µ—Ç–∞–ª–∏ (-10% –°—Ç–∞–±)", eff:()=>{state.resources.stab-=10}}] },
                { t: "–≠–ö–û–ù–û–ú–ò–ß–ï–°–ö–ò–ô –ë–£–ú", d: "–ù–∞—à–∏ —Ä–µ—Ñ–æ—Ä–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç. –†—ã–Ω–∫–∏ —Ä–∞—Å—Ç—É—Ç.", opts: [{t:"–ò–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –∞—Ä–º–∏—é (+50B)", eff:()=>{state.resources.money+=50}}, {t:"–†–∞–∑–¥–∞—Ç—å –Ω–∞—Ä–æ–¥—É (+10% –°—Ç–∞–±)", eff:()=>{state.resources.stab+=10}}] }
            ];
            
            const ev = events[Math.floor(Math.random() * events.length)];
            
            // –ü–∞—É–∑–∞
            const oldSpeed = state.speed;
            setSpeed(0);
            
            const modal = document.getElementById('event-modal');
            modal.classList.remove('hidden');
            
            document.getElementById('ev-title').innerText = ev.t;
            document.getElementById('ev-desc').innerText = ev.d;
            
            const cont = document.getElementById('ev-options');
            cont.innerHTML = '';
            
            ev.opts.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "w-full py-2 bg-gray-800 hover:bg-gray-700 text-xs border border-gray-600 mb-2 text-left px-4";
                btn.innerText = `> ${opt.t}`;
                btn.onclick = () => {
                    opt.eff();
                    updateTopBar();
                    modal.classList.add('hidden');
                    setSpeed(oldSpeed);
                };
                cont.appendChild(btn);
            });
        }

        function addNews(text) {
            const feed = document.getElementById('news-feed');
            feed.innerText = `+++ ${text} +++ ` + feed.innerText;
        }

    </script>
</body>
</html>
