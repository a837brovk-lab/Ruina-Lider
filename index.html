<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ruina Lider: Iron Strategy - Grand Campaign</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Special+Elite&family=Stardos+Stencil:wght@400;700&display=swap');

        :root {
            --iron-dark: #121412;
            --iron-panel: #242724;
            --iron-border: #3d423d;
            --iron-accent: #c2a35d;
            --iron-olive: #4c5844;
            --iron-red: #7a1d1d;
            --iron-text: #d1d4c9;
            --iron-shadow: rgba(0,0,0,0.8);
        }

        body, html {
            margin: 0; padding: 0;
            width: 100vw; height: 100vh;
            background-color: var(--iron-dark);
            color: var(--iron-text);
            font-family: 'Special Elite', cursive;
            overflow: hidden;
            user-select: none;
        }

        /* –¢–µ–∫—Å—Ç—É—Ä–∞ –≥—Ä—É–±–æ–≥–æ –º–µ—Ç–∞–ª–ª–∞ */
        .metal-surface {
            background-color: var(--iron-panel);
            background-image: 
                radial-gradient(circle at 50% 50%, rgba(255,255,255,0.02) 0%, transparent 80%),
                url('https://www.transparenttextures.com/patterns/dark-matter.png');
            box-shadow: inset 0 0 15px rgba(0,0,0,0.5);
            border: 2px solid #000;
        }

        .iron-border {
            border: 3px solid #1a1c1a;
            outline: 1px solid var(--iron-border);
        }

        /* –ö–Ω–æ–ø–∫–∏ "–†—ã—á–∞–≥–∏" */
        .iron-btn {
            background: linear-gradient(to bottom, #5d6b54 0%, #2a3126 100%);
            border: 2px solid #111;
            color: #fff;
            text-shadow: 1px 1px 2px #000;
            font-family: 'Stardos Stencil', sans-serif;
            letter-spacing: 1px;
            box-shadow: 0 3px 0 #111;
            transition: all 0.1s;
            position: relative;
            overflow: hidden;
        }

        .iron-btn::after {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 50%;
            background: rgba(255,255,255,0.05);
        }

        .iron-btn:hover { filter: brightness(1.1); }
        .iron-btn:active {
            transform: translateY(2px);
            box-shadow: 0 1px 0 #000;
        }

        .iron-btn.danger { background: linear-gradient(to bottom, #8b2d2d 0%, #4a1212 100%); }

        /* –ö–∞—Ä—Ç–∞ –≤ —Å—Ç–∏–ª–µ –≥–µ–Ω—à—Ç–∞–±–∞ */
        .province {
            stroke: rgba(0,0,0,0.3);
            stroke-width: 0.8;
            transition: fill 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            filter: saturate(0.8);
        }

        .province:hover {
            filter: brightness(1.3) saturate(1.2);
            stroke: var(--iron-accent);
            stroke-width: 2;
        }

        .sea-texture {
            fill: #141b21;
            background-image: radial-gradient(#1c262e 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* –û–∫–Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ */
        .hq-window {
            position: absolute;
            z-index: 100;
            display: none;
            flex-direction: column;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes scanline {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100%); }
        }

        .screen-overlay {
            position: fixed;
            inset: 0;
            pointer-events: none;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.02), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.02));
            background-size: 100% 3px, 3px 100%;
            z-index: 999;
            opacity: 0.3;
        }

        /* –°–∫—Ä–æ–ª–ª–±–∞—Ä—ã */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--iron-dark); }
        ::-webkit-scrollbar-thumb { background: var(--iron-border); border: 2px solid var(--iron-dark); }

        .tab-active {
            background: var(--iron-olive) !important;
            border-bottom: none !important;
            z-index: 10;
        }

        .node-tech {
            width: 40px; height: 40px;
            background: #1a1c1a;
            border: 2px solid var(--iron-border);
            border-radius: 4px;
            cursor: pointer;
        }
        .node-tech.unlocked { background: var(--iron-accent); box-shadow: 0 0 10px var(--iron-accent); }
    </style>
</head>
<body>

    <div class="screen-overlay"></div>

    <!-- –ó–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω -->
    <div id="boot-screen" class="fixed inset-0 z-[1000] bg-black flex flex-col items-center justify-center p-10">
        <div class="max-w-xl w-full">
            <h1 class="text-6xl font-black italic text-gray-800 mb-2 font-['Stardos_Stencil']">RUINA LIDER IV</h1>
            <div class="text-xs text-emerald-900 mono mb-8 tracking-[0.5em]">OPERATIONAL SYSTEM: V.10.2.8 STEEL-CORE</div>
            
            <div class="space-y-1 mb-10">
                <div id="boot-log" class="text-[10px] text-emerald-800 h-24 overflow-hidden leading-tight italic"></div>
            </div>

            <div class="w-full h-1 bg-gray-900 border border-gray-800 p-[2px]">
                <div id="boot-progress" class="h-full bg-emerald-900 w-0 transition-all"></div>
            </div>
            <div class="mt-4 flex justify-between text-[10px] text-gray-700 font-bold uppercase">
                <span>Memory Check: OK</span>
                <span id="boot-status">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</span>
                <span>CPU-0: 38¬∞C</span>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div id="main-app" class="hidden w-screen h-screen flex flex-col">
        
        <!-- –í–µ—Ä—Ö–Ω–∏–π HUD -->
        <header class="h-14 metal-surface flex items-center px-4 gap-2 z-50 border-b-4 border-black">
            <div class="flex items-center gap-4 bg-black/40 px-3 py-1 iron-border rounded shadow-inner">
                <div class="flex flex-col items-center">
                    <span class="text-[8px] font-bold text-gray-500 uppercase">–ü–æ–ª–∏—Ç. –≤–ª–∞—Å—Ç—å</span>
                    <div class="flex items-center gap-1">
                        <span class="text-blue-500 text-xs">üíß</span>
                        <span id="stat-pp" class="text-sm font-bold mono">150</span>
                        <span class="text-[9px] text-emerald-500">+0.12</span>
                    </div>
                </div>
                <div class="w-px h-6 bg-white/5"></div>
                <div class="flex flex-col items-center">
                    <span class="text-[8px] font-bold text-gray-500 uppercase">–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å</span>
                    <div class="flex items-center gap-1">
                        <span class="text-yellow-500 text-xs">‚öñÔ∏è</span>
                        <span id="stat-stab" class="text-sm font-bold mono">78%</span>
                    </div>
                </div>
                <div class="w-px h-6 bg-white/5"></div>
                <div class="flex flex-col items-center">
                    <span class="text-[8px] font-bold text-gray-500 uppercase">–†–µ–∑–µ—Ä–≤—ã</span>
                    <div class="flex items-center gap-1">
                        <span class="text-green-500 text-xs">üë®‚Äç‚úàÔ∏è</span>
                        <span id="stat-mp" class="text-sm font-bold mono">1.42M</span>
                    </div>
                </div>
                <div class="w-px h-6 bg-white/5"></div>
                <div class="flex flex-col items-center">
                    <span class="text-[8px] font-bold text-gray-500 uppercase">–ü—Ä–æ–º. –º–æ—â–Ω–æ—Å—Ç—å</span>
                    <div class="flex items-center gap-1">
                        <span class="text-orange-500 text-xs">üè≠</span>
                        <span id="stat-industry" class="text-sm font-bold mono">12/32</span>
                    </div>
                </div>
            </div>

            <!-- –†–µ—Å—É—Ä—Å—ã -->
            <div class="flex-grow flex justify-center gap-4">
                <div class="flex items-center gap-2 px-2 bg-black/20 rounded border border-white/5" title="–ù–µ—Ñ—Ç—å">
                    <span class="text-xs">üõ¢Ô∏è</span> <span id="res-oil" class="text-[10px] font-bold">42</span>
                </div>
                <div class="flex items-center gap-2 px-2 bg-black/20 rounded border border-white/5" title="–°—Ç–∞–ª—å">
                    <span class="text-xs">‚öôÔ∏è</span> <span id="res-steel" class="text-[10px] font-bold">120</span>
                </div>
                <div class="flex items-center gap-2 px-2 bg-black/20 rounded border border-white/5" title="–ê–ª—é–º–∏–Ω–∏–π">
                    <span class="text-xs">‚õìÔ∏è</span> <span id="res-alu" class="text-[10px] font-bold">15</span>
                </div>
            </div>

            <!-- –í—Ä–µ–º—è -->
            <div class="flex items-center gap-4">
                <div class="text-right">
                    <div id="game-time" class="text-sm font-bold tracking-widest text-gray-300">01:00, 1 JAN, 1936</div>
                    <div id="speed-indicator" class="text-[9px] font-bold text-gray-600 uppercase text-right">PAUSED</div>
                </div>
                <div class="flex bg-black/60 p-1 iron-border rounded gap-1">
                    <button onclick="setSpeed(0)" class="w-7 h-7 flex items-center justify-center hover:bg-white/5 transition">‚è∏</button>
                    <button onclick="setSpeed(1)" class="w-7 h-7 flex items-center justify-center hover:bg-white/5 transition">‚ñ∂</button>
                    <button onclick="setSpeed(2)" class="w-7 h-7 flex items-center justify-center hover:bg-white/5 transition">‚è©</button>
                    <button onclick="setSpeed(3)" class="w-7 h-7 flex items-center justify-center hover:bg-white/5 transition text-orange-500">‚è©‚è©</button>
                </div>
            </div>
        </header>

        <main class="flex-grow flex relative overflow-hidden">
            
            <!-- –õ–µ–≤–∞—è –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
            <aside class="w-16 metal-surface flex flex-col items-center py-4 gap-4 z-40 border-r-4 border-black">
                <button onclick="toggleWindow('win-politics')" class="w-12 h-12 iron-border bg-[#2a2d2a] flex items-center justify-center hover:bg-gray-700 transition" title="–ü–æ–ª–∏—Ç–∏–∫–∞">üèõÔ∏è</button>
                <button onclick="toggleWindow('win-tech')" class="w-12 h-12 iron-border bg-[#2a2d2a] flex items-center justify-center hover:bg-gray-700 transition" title="–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏">üî¨</button>
                <button onclick="toggleWindow('win-trade')" class="w-12 h-12 iron-border bg-[#2a2d2a] flex items-center justify-center hover:bg-gray-700 transition" title="–¢–æ—Ä–≥–æ–≤–ª—è">‚öñÔ∏è</button>
                <button onclick="toggleWindow('win-const')" class="w-12 h-12 iron-border bg-[#2a2d2a] flex items-center justify-center hover:bg-gray-700 transition" title="–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ">üèóÔ∏è</button>
                <button onclick="toggleWindow('win-army')" class="w-12 h-12 iron-border bg-[#2a2d2a] flex items-center justify-center hover:bg-gray-700 transition" title="–ê—Ä–º–∏—è">üéñÔ∏è</button>
                <div class="mt-auto">
                    <button onclick="toggleLog()" class="w-10 h-10 text-xs opacity-40 hover:opacity-100 transition">üìú</button>
                </div>
            </aside>

            <!-- –ì–õ–ê–í–ù–ê–Ø –ö–ê–†–¢–ê -->
            <div id="map-viewport" class="flex-grow relative bg-[#0a0c0a] overflow-hidden">
                <svg id="canvas-map" class="w-full h-full"></svg>
                
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ -->
                <div id="hover-info" class="absolute pointer-events-none bg-black/80 p-2 text-[10px] iron-border hidden z-50">
                    <div id="hover-country" class="font-bold text-gray-200">USSR</div>
                    <div id="hover-terrain" class="italic text-gray-500">–†–∞–≤–Ω–∏–Ω—ã</div>
                </div>

                <!-- –ü–ª–∞–≤–∞—é—â–µ–µ –æ–∫–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å—Ç—Ä–∞–Ω–µ (SIDE PANEL) -->
                <div id="target-panel" class="absolute top-4 right-4 w-72 h-[calc(100%-2rem)] hq-window metal-surface iron-border p-4 shadow-2xl flex-col">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h2 id="tg-name" class="text-2xl font-['Stardos_Stencil'] leading-none">GERMANY</h2>
                            <div id="tg-ideology" class="text-[9px] font-bold text-gray-500 uppercase mt-1">–§–∞—à–∏–∑–º</div>
                        </div>
                        <button onclick="closeTarget()" class="text-red-900 font-bold text-lg hover:text-red-500">√ó</button>
                    </div>

                    <div class="space-y-4 flex-grow overflow-y-auto pr-2">
                        <div class="bg-black/40 p-3 iron-border">
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-[10px] text-gray-500">–û—Ç–Ω–æ—à–µ–Ω–∏—è:</span>
                                <span id="tg-rel" class="text-xs font-bold text-emerald-500">+10</span>
                            </div>
                            <div class="w-full h-1 bg-gray-900">
                                <div id="tg-rel-bar" class="h-full bg-emerald-600 w-1/2"></div>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-2">
                            <div class="bg-black/20 p-2 border border-white/5">
                                <div class="text-[8px] text-gray-500 uppercase">–î–∏–≤–∏–∑–∏–∏</div>
                                <div id="tg-div" class="text-lg font-bold">~42</div>
                            </div>
                            <div class="bg-black/20 p-2 border border-white/5">
                                <div class="text-[8px] text-gray-500 uppercase">–ü—Ä–æ–º-—Å—Ç—å</div>
                                <div id="tg-ind" class="text-lg font-bold">120</div>
                            </div>
                        </div>

                        <div class="space-y-2 pt-4">
                            <button onclick="diplomacy('war')" class="w-full py-3 iron-btn danger text-xs uppercase">–û–±—ä—è–≤–∏—Ç—å –≤–æ–π–Ω—É</button>
                            <button onclick="diplomacy('improve')" class="w-full py-2 iron-btn text-[10px] uppercase">–£–ª—É—á—à–∏—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏—è</button>
                            <button onclick="diplomacy('trade')" class="w-full py-2 iron-btn text-[10px] uppercase">–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ç–æ—Ä–≥–æ–≤–ª—é</button>
                            <button onclick="diplomacy('coup')" class="w-full py-2 iron-btn text-[10px] uppercase">–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–∏–µ</button>
                        </div>

                        <div class="border-t border-white/10 pt-4">
                            <div class="text-[9px] font-bold text-gray-600 mb-2 uppercase tracking-widest">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ì–µ–Ω—à—Ç–∞–±–∞</div>
                            <p id="tg-intel" class="text-[10px] italic text-gray-400 leading-relaxed">–ù–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ, –æ–¥–Ω–∞–∫–æ –Ω–∞—Ä–∞—â–∏–≤–∞–µ—Ç –≤–æ–µ–Ω–Ω—ã–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª —É –Ω–∞—à–∏—Ö –≥—Ä–∞–Ω–∏—Ü.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –û–ö–ù–û –¢–ï–•–ù–û–õ–û–ì–ò–ô -->
            <div id="win-tech" class="hq-window w-[800px] h-[600px] top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 metal-surface iron-border p-0 shadow-2xl">
                <div class="h-10 flex bg-black items-center px-4 justify-between border-b-2 border-white/10">
                    <span class="text-sm font-bold tracking-widest uppercase">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç</span>
                    <button onclick="closeWindow('win-tech')" class="text-gray-500 hover:text-white">‚úï</button>
                </div>
                <div class="flex h-10 bg-[#1a1c1a]">
                    <button class="flex-1 text-[10px] font-bold uppercase border-r border-white/5 tab-active">–ü–µ—Ö–æ—Ç–∞</button>
                    <button class="flex-1 text-[10px] font-bold uppercase border-r border-white/5 hover:bg-white/5">–ë—Ä–æ–Ω–µ—Ç–µ—Ö–Ω–∏–∫–∞</button>
                    <button class="flex-1 text-[10px] font-bold uppercase border-r border-white/5 hover:bg-white/5">–ê–≤–∏–∞—Ü–∏—è</button>
                    <button class="flex-1 text-[10px] font-bold uppercase hover:bg-white/5">–§–ª–æ—Ç</button>
                </div>
                <div class="flex-grow p-8 relative overflow-hidden">
                    <div class="flex justify-around items-center h-full">
                        <div class="flex flex-col items-center gap-10">
                            <div class="node-tech unlocked" title="–í–∏–Ω—Ç–æ–≤–∫–∏ 1936"></div>
                            <div class="node-tech" title="–°–Ω–∞—Ä—è–∂–µ–Ω–∏–µ"></div>
                        </div>
                        <div class="flex flex-col items-center gap-10">
                            <div class="node-tech" title="–í–∏–Ω—Ç–æ–≤–∫–∏ 1939"></div>
                            <div class="node-tech" title="–ü–¢–û"></div>
                        </div>
                        <div class="flex flex-col items-center gap-10">
                            <div class="node-tech" title="–°–ø–µ—Ü–Ω–∞–∑"></div>
                        </div>
                    </div>
                    <div class="absolute bottom-4 left-4 text-[10px] text-gray-500 italic">–°–≤–æ–±–æ–¥–Ω—ã—Ö —è—á–µ–µ–∫ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π: 2</div>
                </div>
            </div>

            <!-- –û–ö–ù–û –°–¢–†–û–ò–¢–ï–õ–¨–°–¢–í–ê -->
            <div id="win-const" class="hq-window w-[600px] h-[450px] top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 metal-surface iron-border p-0 shadow-2xl">
                <div class="h-10 flex bg-black items-center px-4 justify-between">
                    <span class="text-sm font-bold uppercase">–ü–ª–∞–Ω –∏–Ω–¥—É—Å—Ç—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏</span>
                    <button onclick="closeWindow('win-const')" class="text-gray-500">‚úï</button>
                </div>
                <div class="flex-grow p-4 flex gap-4">
                    <div class="w-1/2 space-y-2">
                        <div class="text-[10px] font-bold text-gray-500 uppercase border-b border-white/10 pb-1 mb-2">–û–±—ä–µ–∫—Ç—ã</div>
                        <div class="flex justify-between items-center p-2 bg-black/40 border border-white/5 hover:bg-white/5 cursor-pointer">
                            <span class="text-xs">–ì—Ä–∞–∂–¥–∞–Ω—Å–∫–∞—è —Ñ–∞–±—Ä–∏–∫–∞</span>
                            <span class="text-[10px] text-orange-400">15 —Ñ–∞–±.</span>
                        </div>
                        <div class="flex justify-between items-center p-2 bg-black/40 border border-white/5 hover:bg-white/5 cursor-pointer">
                            <span class="text-xs">–í–æ–µ–Ω–Ω—ã–π –∑–∞–≤–æ–¥</span>
                            <span class="text-[10px] text-orange-400">10 —Ñ–∞–±.</span>
                        </div>
                        <div class="flex justify-between items-center p-2 bg-black/40 border border-white/5 hover:bg-white/5 cursor-pointer">
                            <span class="text-xs">–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞</span>
                            <span class="text-[10px] text-orange-400">5 —Ñ–∞–±.</span>
                        </div>
                    </div>
                    <div class="w-1/2 space-y-2 bg-black/20 p-4 iron-border">
                        <div class="text-[10px] font-bold text-gray-600 uppercase mb-4">–û—á–µ—Ä–µ–¥—å —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</div>
                        <div class="text-[10px] italic text-gray-700 text-center mt-10">–û—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞</div>
                    </div>
                </div>
            </div>

            <!-- –õ–û–ì –°–û–ë–´–¢–ò–ô -->
            <div id="game-log" class="absolute bottom-24 left-20 w-80 h-48 bg-black/80 iron-border p-3 overflow-y-auto hidden z-[60]">
                <div class="text-[9px] font-bold text-emerald-800 uppercase mb-2 border-b border-emerald-900/30">–®—Ç–∞–±–Ω–æ–π –∂—É—Ä–Ω–∞–ª</div>
                <div id="log-content" class="text-[10px] mono text-gray-400 flex flex-col-reverse gap-1">
                    <div>> –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–∏–∫–∞–∑–æ–≤.</div>
                </div>
            </div>
        </main>

        <!-- –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å –ê—Ä–º–∏–∏ -->
        <footer class="h-20 metal-surface border-t-4 border-black flex items-center px-4 gap-4 overflow-x-auto">
            <div class="flex-shrink-0 w-48 h-14 bg-black/40 iron-border flex items-center p-2 gap-3 hover:bg-black/60 cursor-pointer">
                <div class="w-10 h-10 bg-gray-800 border border-white/10 flex items-center justify-center text-xs">1-—è</div>
                <div>
                    <div class="text-[10px] font-bold text-gray-300 uppercase">–ì—Ä—É–ø–ø–∞ –ê—Ä–º–∏–π '–ê'</div>
                    <div class="flex gap-1 mt-1">
                        <div class="w-2 h-1 bg-green-500"></div>
                        <div class="w-2 h-1 bg-green-500"></div>
                        <div class="w-2 h-1 bg-gray-700"></div>
                    </div>
                </div>
            </div>
            <div class="flex-shrink-0 w-12 h-12 bg-white/5 border-2 border-dashed border-white/10 flex items-center justify-center text-xl text-white/10 hover:text-white/40 cursor-pointer">+</div>
        </footer>
    </div>

    <script>
        /**
         * Ruina Lider IV: Core Engine
         * –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞: –ì–µ–Ω–µ—Ä–∞–ª—å–Ω—ã–π –®—Ç–∞–±
         */

        const CONFIG = {
            IDEOLOGIES: {
                'democracy': { name: '–î–µ–º–æ–∫—Ä–∞—Ç–∏—è', color: '#4682b4', icon: '‚öñÔ∏è' },
                'communism': { name: '–ö–æ–º–º—É–Ω–∏–∑–º', color: '#8b0000', icon: 'üö©' },
                'fascism': { name: '–§–∞—à–∏–∑–º', color: '#4b4b4b', icon: 'ü¶Ö' },
                'neutrality': { name: '–ù–µ–π—Ç—Ä–∞–ª–∏—Ç–µ—Ç', color: '#556b2f', icon: 'üéñÔ∏è' }
            },
            TERRAINS: ['–†–∞–≤–Ω–∏–Ω—ã', '–ì–æ—Ä—ã', '–õ–µ—Å–∞', '–•–æ–ª–º—ã', '–ü—É—Å—Ç—ã–Ω–∏'],
            RESOURCE_TYPES: ['steel', 'oil', 'alu']
        };

        const state = {
            player: null,
            selected: null,
            speed: 0,
            date: new Date(1936, 0, 1, 1),
            resources: { pp: 150, stab: 78, manpower: 1.42, factories: 12, steel: 120, oil: 42, alu: 15 },
            countries: [],
            isLogOpen: false
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
        window.addEventListener('load', () => {
            const bootLogs = [
                "Initializing Kernel...",
                "Loading World Map Geometry...",
                "Calculating Supply Lines...",
                "Parsing Diplomacy Matrices...",
                "Contacting Command Center...",
                "System Check: 100% Secure"
            ];
            
            let logIdx = 0;
            const logEl = document.getElementById('boot-log');
            const interval = setInterval(() => {
                const entry = document.createElement('div');
                entry.innerText = `[OK] ${bootLogs[logIdx]}`;
                logEl.appendChild(entry);
                logIdx++;
                
                document.getElementById('boot-progress').style.width = (logIdx / bootLogs.length * 100) + '%';
                
                if (logIdx >= bootLogs.length) {
                    clearInterval(interval);
                    document.getElementById('boot-status').innerText = "–ì–æ—Ç–æ–≤–æ –∫ –∑–∞–ø—É—Å–∫—É";
                    setTimeout(() => {
                        document.getElementById('boot-screen').classList.add('hidden');
                        document.getElementById('main-app').classList.remove('hidden');
                        initGame();
                    }, 500);
                }
            }, 300);
        });

        async function initGame() {
            try {
                // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã, –µ—Å–ª–∏ –Ω–µ –≤—ã–π–¥–µ—Ç -fallback
                const response = await fetch('https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson');
                const data = await response.json();
                
                state.countries = data.features.map((f, i) => ({
                    id: f.id || `c${i}`,
                    name: f.properties.name,
                    feature: f,
                    ideology: Object.keys(CONFIG.IDEOLOGIES)[Math.floor(Math.random()*4)],
                    army: Math.floor(Math.random()*60) + 10,
                    industry: Math.floor(Math.random()*150),
                    rel: Math.floor(Math.random()*100) - 50,
                    terrain: CONFIG.TERRAINS[Math.floor(Math.random()*CONFIG.TERRAINS.length)]
                }));
            } catch (err) {
                console.error("Map Load Error, using procedural fallback");
            }

            renderMap();
            startGameLoop();
            addLog("–®—Ç–∞–± —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç. –û–∂–∏–¥–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –Ω–∞—Ü–∏–∏.");
        }

        function renderMap() {
            const svg = d3.select("#canvas-map");
            const container = document.getElementById('map-viewport');
            const width = container.clientWidth;
            const height = container.clientHeight;

            const projection = d3.geoNaturalEarth1()
                .scale(width / 5.5)
                .translate([width / 2.3, height / 2.1]);

            const path = d3.geoPath().projection(projection);
            const g = svg.append("g");

            // –û–∫–µ–∞–Ω
            g.append("rect")
                .attr("width", width * 3)
                .attr("height", height * 3)
                .attr("x", -width)
                .attr("y", -height)
                .attr("class", "sea-texture");

            // –ü—Ä–æ–≤–∏–Ω—Ü–∏–∏
            g.selectAll(".province")
                .data(state.countries)
                .enter()
                .append("path")
                .attr("d", d => path(d.feature))
                .attr("class", "province")
                .attr("fill", d => CONFIG.IDEOLOGIES[d.ideology].color)
                .on("mouseenter", function(e, d) {
                    const info = document.getElementById('hover-info');
                    info.classList.remove('hidden');
                    document.getElementById('hover-country').innerText = d.name;
                    document.getElementById('hover-terrain').innerText = d.terrain;
                })
                .on("mousemove", function(e) {
                    const info = document.getElementById('hover-info');
                    info.style.top = (e.pageY + 10) + 'px';
                    info.style.left = (e.pageX + 10) + 'px';
                })
                .on("mouseleave", () => document.getElementById('hover-info').classList.add('hidden'))
                .on("click", (e, d) => selectCountry(d));

            // –ó—É–º
            svg.call(d3.zoom()
                .scaleExtent([0.8, 12])
                .on("zoom", (e) => g.attr("transform", e.transform)));
        }

        function selectCountry(d) {
            state.selected = d;
            
            // –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –µ—â–µ –Ω–µ –≤—ã–±—Ä–∞–Ω - –Ω–∞–∑–Ω–∞—á–∞–µ–º
            if (!state.player) {
                state.player = d;
                addLog(`–ú—ã –≤–∑—è–ª–∏ –ø–æ–¥ –∫–æ–º–∞–Ω–¥–æ–≤–∞–Ω–∏–µ: ${d.name}`);
                document.getElementById('stat-pp').innerText = state.resources.pp;
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º UI –ø–∞–Ω–µ–ª–∏
            const panel = document.getElementById('target-panel');
            panel.style.display = 'flex';
            document.getElementById('tg-name').innerText = d.name.toUpperCase();
            document.getElementById('tg-ideology').innerText = CONFIG.IDEOLOGIES[d.ideology].name;
            document.getElementById('tg-rel').innerText = (d.rel > 0 ? '+' : '') + d.rel;
            document.getElementById('tg-rel-bar').style.width = (d.rel + 100) / 2 + '%';
            document.getElementById('tg-div').innerText = `~${d.army}`;
            document.getElementById('tg-ind').innerText = d.industry;

            d3.selectAll(".province").attr("stroke-width", 0.8).attr("stroke", "rgba(0,0,0,0.3)");
            d3.select(event.currentTarget).attr("stroke", "var(--iron-accent)").attr("stroke-width", 2);
        }

        function setSpeed(s) {
            state.speed = s;
            const labels = ["PAUSED", "NORMAL x1", "FAST x3", "BLITZ x5"];
            document.getElementById('speed-indicator').innerText = labels[s];
            document.getElementById('speed-indicator').style.color = s === 3 ? 'var(--iron-accent)' : '#4b5563';
        }

        function startGameLoop() {
            setInterval(() => {
                if (state.speed === 0) return;

                // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
                const speedFactor = [0, 1, 3, 10][state.speed];
                state.date.setHours(state.date.getHours() + speedFactor);

                // –ü–∞—Å—Å–∏–≤–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
                if (state.player) {
                    state.resources.pp += (0.01 * speedFactor);
                    document.getElementById('stat-pp').innerText = Math.floor(state.resources.pp);
                }

                updateClock();
                
                // –°–ª—É—á–∞–π–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
                if (Math.random() < 0.001 * speedFactor) {
                    processEvent();
                }
            }, 1000);
        }

        function updateClock() {
            const months = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
            const d = state.date;
            const str = `${d.getHours().toString().padStart(2, '0')}:00, ${d.getDate()} ${months[d.getMonth()]}, ${d.getFullYear()}`;
            document.getElementById('game-time').innerText = str;
        }

        function processEvent() {
            const events = [
                "–†–∞–±–æ—á–∏–µ —Ç—Ä–µ–±—É—é—Ç –ø–æ–≤—ã—à–µ–Ω–∏—è –∑–∞—Ä–ø–ª–∞—Ç—ã: –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å -2%",
                "–î–∏–ø–ª–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —É—Å–ø–µ—Ö –≤ –ï–≤—Ä–æ–ø–µ: –ü–æ–ª–∏—Ç. –≤–ª–∞—Å—Ç—å +20",
                "–ù–æ–≤—ã–µ –º–µ—Å—Ç–æ—Ä–æ–∂–¥–µ–Ω–∏—è —Å—Ç–∞–ª–∏ —Ä–∞–∑–≤–µ–¥–∞–Ω—ã: –†–µ—Å—É—Ä—Å—ã +15",
                "–ü—Ä–æ–≤–æ–∫–∞—Ü–∏—è –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ: –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å –ø—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –ø–∞–¥–∞–µ—Ç"
            ];
            addLog(events[Math.floor(Math.random() * events.length)], "text-orange-500");
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–∫–Ω–∞–º–∏
        function toggleWindow(id) {
            const win = document.getElementById(id);
            const isVisible = win.style.display === 'flex';
            
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ
            document.querySelectorAll('.hq-window').forEach(w => {
                if(w.id !== 'target-panel') w.style.display = 'none';
            });

            if (!isVisible) win.style.display = 'flex';
        }

        function closeWindow(id) { document.getElementById(id).style.display = 'none'; }
        function closeTarget() { document.getElementById('target-panel').style.display = 'none'; }
        function toggleLog() { 
            state.isLogOpen = !state.isLogOpen;
            document.getElementById('game-log').style.display = state.isLogOpen ? 'block' : 'none';
        }

        function addLog(msg, color = "text-gray-400") {
            const container = document.getElementById('log-content');
            const entry = document.createElement('div');
            entry.className = color;
            entry.innerText = `> [${state.date.getHours()}:00] ${msg}`;
            container.prepend(entry);
        }

        function diplomacy(action) {
            if (!state.selected) return;
            const t = state.selected;
            
            switch(action) {
                case 'war':
                    addLog(`–ú–´ –û–ë–™–Ø–í–ò–õ–ò –í–û–ô–ù–£: ${t.name}!`, "text-red-600 font-bold");
                    t.rel = -100;
                    d3.selectAll(".province").filter(d => d.id === t.id).attr("fill", "var(--iron-red)");
                    break;
                case 'improve':
                    if (state.resources.pp >= 10) {
                        state.resources.pp -= 10;
                        t.rel = Math.min(100, t.rel + 5);
                        addLog(`–î–∏–ø–ª–æ–º–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ ${t.name}`);
                    }
                    break;
            }
            selectCountry(t); // —Ä–µ—Ñ—Ä–µ—à –ø–∞–Ω–µ–ª–∏
        }

        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏-–∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
    </script>
</body>
</html>
