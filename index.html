<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruina Leader: Iron Will</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Roboto+Condensed:wght@400;700&display=swap');

        :root {
            --hoi-bg: #1a1b1e;
            --hoi-panel: #24272b;
            --hoi-border: #4a4d52;
            --hoi-gold: #e2c08d;
            --hoi-text: #cccccc;
            --hoi-green: #4da358;
            --hoi-red: #c94f4f;
        }

        body {
            background-color: #050505;
            color: var(--hoi-text);
            font-family: 'Roboto Condensed', sans-serif;
            overflow: hidden;
            user-select: none;
        }

        /* --- –≠–§–§–ï–ö–¢–´ --- */
        .scanline {
            width: 100%; height: 100px; z-index: 999; pointer-events: none; position: absolute;
            background: linear-gradient(0deg, transparent, rgba(226, 192, 141, 0.05), transparent);
            animation: scan 10s linear infinite; top: -100px;
        }
        @keyframes scan { to { top: 100%; } }

        .crt-overlay {
            position: fixed; inset: 0; pointer-events: none; z-index: 998;
            background: radial-gradient(circle, rgba(0,0,0,0) 60%, rgba(0,0,0,0.4) 100%);
            box-shadow: inset 0 0 50px rgba(0,0,0,0.5);
        }

        /* --- UI –ö–û–ú–ü–û–ù–ï–ù–¢–´ --- */
        .hoi-panel {
            background: url('https://www.transparenttextures.com/patterns/dark-matter.png'), var(--hoi-panel);
            border: 2px solid #000;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.8), 0 0 10px rgba(0,0,0,0.5);
            outline: 1px solid var(--hoi-border);
        }

        .hoi-header {
            font-family: 'Playfair Display', serif;
            color: var(--hoi-gold);
            text-shadow: 2px 2px 0px #000;
            letter-spacing: 1px;
        }

        .hoi-btn {
            background: linear-gradient(to bottom, #4a5157, #2d3238);
            border: 1px solid #000;
            color: #fff;
            text-shadow: 1px 1px 0 #000;
            padding: 8px 16px;
            font-weight: bold;
            text-transform: uppercase;
            box-shadow: 0 4px 0 #1a1a1a;
            transition: all 0.1s;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .hoi-btn:hover:not(:disabled) { filter: brightness(1.2); transform: translateY(-1px); }
        .hoi-btn:active:not(:disabled) { transform: translateY(2px); box-shadow: 0 1px 0 #1a1a1a; }
        .hoi-btn:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(1); }

        .hoi-btn-green { background: linear-gradient(to bottom, #4da358, #2e6b36); }
        .hoi-btn-red { background: linear-gradient(to bottom, #c94f4f, #8a2a2a); }

        .resource-box {
            display: flex; align-items: center; gap: 6px;
            background: rgba(0,0,0,0.3); padding: 4px 10px;
            border: 1px solid var(--hoi-border); border-radius: 4px;
        }

        /* --- –ö–ê–†–¢–ê --- */
        .province { stroke: #000; stroke-width: 0.3; transition: fill 0.2s; }
        .province:hover { stroke: #fff; stroke-width: 1; cursor: pointer; filter: brightness(1.2); }
        .province.selected { stroke: var(--hoi-gold); stroke-width: 2; }

        /* –ò–¥–µ–æ–ª–æ–≥–∏–∏ */
        .ideo-fascism { color: #a37256; }
        .ideo-communism { color: #c94f4f; }
        .ideo-democracy { color: #6db0ff; }
        .ideo-neutrality { color: #9e9e9e; }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal-overlay {
            position: fixed; inset: 0; bg-black/80; backdrop-filter: blur(5px);
            z-index: 2000; display: none; align-items: center; justify-content: center;
        }
    </style>
</head>
<body>

    <div class="scanline"></div>
    <div class="crt-overlay"></div>

    <!-- –ú–ï–ù–Æ –í–´–ë–û–†–ê –°–¢–†–ê–ù–´ -->
    <div id="setup-screen" class="fixed inset-0 z-[1000] bg-[#0d0e10] flex items-center justify-center p-8 bg-[url('https://www.transparenttextures.com/patterns/black-scales.png')]">
        <div class="w-full max-w-7xl h-[90vh] hoi-panel flex overflow-hidden shadow-2xl relative">
            
            <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –°–ø–∏—Å–æ–∫ -->
            <div class="w-1/4 border-r border-gray-700 flex flex-col bg-[#16181b]">
                <div class="p-4 border-b border-gray-700 bg-[#202328]">
                    <h1 class="hoi-header text-3xl mb-1">RUINA LEADER</h1>
                    <p class="text-[10px] uppercase text-gray-500 font-bold tracking-widest">Grand Strategy v2.0</p>
                </div>
                <div class="p-2 bg-black/20">
                    <input type="text" id="country-search" placeholder="–ü–æ–∏—Å–∫ –¥–µ—Ä–∂–∞–≤—ã..." class="w-full bg-[#0a0a0a] border border-gray-600 p-2 text-xs text-gray-300 outline-none focus:border-yellow-600">
                </div>
                <div id="country-list" class="flex-grow overflow-y-auto custom-scroll p-2 space-y-1">
                    <!-- JS Injected -->
                </div>
            </div>

            <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –î–µ—Ç–∞–ª–∏ -->
            <div class="flex-grow flex flex-col relative bg-[#121316]">
                <!-- –ó–∞–≥–ª—É—à–∫–∞ -->
                <div id="empty-state" class="absolute inset-0 flex flex-col items-center justify-center text-gray-600 pointer-events-none">
                    <svg class="w-32 h-32 mb-4 opacity-20" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
                    <span class="uppercase tracking-widest font-bold opacity-50">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É –¥–ª—è –Ω–∞—á–∞–ª–∞</span>
                </div>

                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
                <div id="preview-content" class="hidden h-full flex flex-col p-10">
                    <div class="flex justify-between items-start mb-8">
                        <div>
                            <h2 id="p-name" class="text-6xl font-black text-white uppercase tracking-tighter shadow-black drop-shadow-lg">–†–û–°–°–ò–Ø</h2>
                            <div class="flex items-center gap-3 mt-2">
                                <span id="p-ideology" class="px-2 py-0.5 bg-black/50 border border-gray-600 text-xs font-bold uppercase text-gray-300">–ê–≤—Ç–æ—Ä–∏—Ç–∞—Ä–∏–∑–º</span>
                                <span class="text-xs text-gray-500">–°–¶–ï–ù–ê–†–ò–ô: 2000</span>
                            </div>
                        </div>
                        <img id="p-flag" class="w-40 h-24 border-4 border-[#24272b] shadow-2xl">
                    </div>

                    <div class="flex gap-10 flex-grow">
                        <div class="w-64 h-80 bg-black border-4 border-[#e2c08d] relative shadow-2xl group">
                            <img id="p-leader-img" class="w-full h-full object-cover filter grayscale sepia-[0.2] group-hover:filter-none transition duration-500">
                            <div class="absolute bottom-0 w-full bg-black/80 p-2 text-center border-t border-[#e2c08d]">
                                <span id="p-leader-name" class="text-[#e2c08d] font-bold text-sm uppercase font-serif tracking-wider"></span>
                            </div>
                        </div>

                        <div class="flex-grow flex flex-col gap-6">
                            <div class="bg-[#1a1b1e] border border-gray-700 p-6 shadow-inner">
                                <h3 class="text-xs text-gray-500 font-bold uppercase mb-4 tracking-widest border-b border-gray-700 pb-2">–†–∞–∑–≤–µ–¥–¥–∞–Ω–Ω—ã–µ</h3>
                                <div class="grid grid-cols-2 gap-6">
                                    <div>
                                        <span class="block text-[10px] text-gray-500 uppercase">–í–í–ü</span>
                                        <span id="p-gdp" class="text-2xl font-bold text-[#4da358]">$260B</span>
                                    </div>
                                    <div>
                                        <span class="block text-[10px] text-gray-500 uppercase">–ê—Ä–º–∏—è</span>
                                        <span id="p-army" class="text-2xl font-bold text-[#c94f4f]">1.2M</span>
                                    </div>
                                    <div>
                                        <span class="block text-[10px] text-gray-500 uppercase">–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å</span>
                                        <span id="p-stab" class="text-xl font-bold text-[#e2c08d]">65%</span>
                                    </div>
                                    <div>
                                        <span class="block text-[10px] text-gray-500 uppercase">–ü–æ–ø—É–ª—è—Ü–∏—è</span>
                                        <span id="p-pop" class="text-xl font-bold text-gray-300">146M</span>
                                    </div>
                                </div>
                            </div>
                            
                            <p id="p-desc" class="text-sm text-gray-400 italic leading-relaxed border-l-2 border-[#e2c08d] pl-4"></p>
                            
                            <div class="mt-auto">
                                <button onclick="startGame()" class="hoi-btn hoi-btn-green w-full py-4 text-xl tracking-widest shadow-lg hover:scale-[1.01] transition-transform">
                                    <span class="text-2xl">‚ö°</span> –ü–†–ò–ù–Ø–¢–¨ –£–ü–†–ê–í–õ–ï–ù–ò–ï
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ò–ì–†–û–í–û–ô –≠–ö–†–ê–ù -->
    <div id="game-ui" class="hidden h-screen flex flex-col bg-[#0b0c0e]">
        
        <!-- –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ -->
        <header class="h-12 bg-gradient-to-b from-[#2d3238] to-[#1a1b1e] border-b border-black flex items-center justify-between px-4 z-50 shadow-lg">
            <div class="flex items-center gap-6">
                <div class="flex items-center gap-2" title="–í–∞—à–∞ —Å—Ç—Ä–∞–Ω–∞">
                    <img id="ui-flag" class="w-8 h-5 border border-white/20">
                    <span id="ui-country" class="font-bold text-sm text-[#e2c08d] uppercase tracking-tighter"></span>
                </div>
                
                <!-- –†–µ—Å—É—Ä—Å—ã -->
                <div class="flex gap-4 text-xs font-mono">
                    <div class="resource-box" title="–ü–æ–ª–∏—Ç–∏—á–µ—Å–∫–∞—è –≤–ª–∞—Å—Ç—å">
                        <span>üèõÔ∏è</span> <span id="res-pp" class="font-bold text-white">150</span>
                    </div>
                    <div class="resource-box" title="–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å">
                        <span>‚öñÔ∏è</span> <span id="res-stab" class="font-bold text-[#e2c08d]">70%</span>
                    </div>
                    <div class="resource-box" title="–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–æ–π–Ω—ã">
                        <span>‚öîÔ∏è</span> <span id="res-war" class="font-bold text-[#c94f4f]">10%</span>
                    </div>
                    <div class="resource-box" title="–õ—é–¥—Å–∫–∏–µ —Ä–µ—Å—É—Ä—Å—ã">
                        <span>üë•</span> <span id="res-man" class="font-bold text-[#4da358]">1.2M</span>
                    </div>
                    <div class="resource-box" title="–§–∞–±—Ä–∏–∫–∏">
                        <span>üè≠</span> <span id="res-fac" class="font-bold text-gray-300">45</span>
                    </div>
                </div>
            </div>

            <div class="flex items-center gap-4">
                <div class="text-xs font-bold bg-black/30 px-3 py-1 rounded text-gray-400">
                    <span id="ui-date">1 –Ø–ù–í 2000</span>
                </div>
                <button class="hoi-btn py-1 px-3 text-xs" onclick="toggleMenu()">–ú–ï–ù–Æ</button>
            </div>
        </header>

        <!-- –û–°–ù–û–í–ù–ê–Ø –ó–û–ù–ê -->
        <main class="flex-grow flex relative overflow-hidden">
            <!-- –ö–∞—Ä—Ç–∞ -->
            <div id="map-container" class="flex-grow bg-[#14181d] relative">
                <svg id="world-map" class="w-full h-full cursor-crosshair"></svg>
                
                <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å –î–ò–ü–õ–û–ú–ê–¢–ò–ò (–°–∫—Ä—ã—Ç–∞) -->
                <div id="diplomacy-panel" class="absolute left-4 top-4 w-96 hoi-panel hidden flex-col z-40 max-h-[90vh] overflow-y-auto animate-slide-in">
                    <div class="p-2 bg-gradient-to-r from-[#2d3238] to-[#1a1b1e] border-b border-black flex justify-between items-center">
                        <span class="font-bold text-[#e2c08d] uppercase tracking-wider ml-2">–î–∏–ø–ª–æ–º–∞—Ç–∏—è</span>
                        <button onclick="closeDiplo()" class="text-gray-500 hover:text-white px-2 font-bold">‚úï</button>
                    </div>
                    
                    <div class="p-4 space-y-4">
                        <!-- –®–∞–ø–∫–∞ —Ü–µ–ª–∏ -->
                        <div class="flex gap-4">
                            <div class="w-20 h-28 bg-black border-2 border-[#e2c08d]">
                                <img id="diplo-leader-img" class="w-full h-full object-cover">
                            </div>
                            <div class="flex-col flex justify-center">
                                <h3 id="diplo-country" class="text-xl font-black uppercase leading-none">–ì–ï–†–ú–ê–ù–ò–Ø</h3>
                                <p id="diplo-leader" class="text-xs text-yellow-600 font-bold mb-2">–ì. –®—Ä—ë–¥–µ—Ä</p>
                                <div class="flex gap-2 text-[10px]">
                                    <span id="diplo-ideology" class="px-2 py-0.5 bg-white/5 border border-white/10 rounded">–î–µ–º–æ–∫—Ä–∞—Ç–∏—è</span>
                                    <span id="diplo-opinion" class="px-2 py-0.5 bg-green-900/30 text-green-400 border border-green-800 rounded">+10</span>
                                </div>
                            </div>
                        </div>

                        <!-- –î–∞–Ω–Ω—ã–µ -->
                        <div class="grid grid-cols-2 gap-2 text-xs">
                            <div class="bg-black/30 p-2 border border-white/5 flex justify-between">
                                <span class="text-gray-500">–ê—Ä–º–∏—è</span>
                                <span id="diplo-army" class="font-bold text-red-400">300K</span>
                            </div>
                            <div class="bg-black/30 p-2 border border-white/5 flex justify-between">
                                <span class="text-gray-500">–ò–Ω–¥—É—Å—Ç—Ä–∏—è</span>
                                <span id="diplo-ind" class="font-bold text-yellow-400">120</span>
                            </div>
                        </div>

                        <!-- –î–µ–π—Å—Ç–≤–∏—è -->
                        <div class="space-y-2 pt-2 border-t border-gray-700">
                            <button onclick="diploAction('war_goal')" class="hoi-btn w-full justify-start border-red-900/50 text-red-300 hover:text-red-100">
                                <span>‚öîÔ∏è</span> –û–ø—Ä–∞–≤–¥–∞—Ç—å —Ü–µ–ª—å –≤–æ–π–Ω—ã
                            </button>
                            <button onclick="diploAction('improve')" class="hoi-btn w-full justify-start">
                                <span>ü§ù</span> –£–ª—É—á—à–∏—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏—è
                            </button>
                            <button onclick="diploAction('alliance')" class="hoi-btn w-full justify-start">
                                <span>üõ°Ô∏è</span> –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –≤ –∞–ª—å—è–Ω—Å
                            </button>
                            <button onclick="diploAction('lend_lease')" class="hoi-btn w-full justify-start">
                                <span>üì¶</span> –ù–∞—á–∞—Ç—å –õ–µ–Ω–¥-–ª–∏–∑
                            </button>
                            <button onclick="diploAction('trade')" class="hoi-btn w-full justify-start">
                                <span>üí∞</span> –¢–æ—Ä–≥–æ–≤–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π -->
        <div id="event-log" class="absolute bottom-2 left-2 w-80 max-h-40 overflow-y-auto pointer-events-none space-y-1 text-[10px] font-mono p-2"></div>
    </div>

    <!-- –ú–û–î–ê–õ–ö–ê –í–û–ô–ù–´ (CASUS BELLI) -->
    <div id="war-modal" class="fixed inset-0 bg-black/90 z-[2000] hidden items-center justify-center backdrop-blur-sm">
        <div class="hoi-panel w-[600px] p-1 shadow-[0_0_50px_rgba(201,79,79,0.2)] border-red-900">
            <div class="bg-[#1a0505] p-6 border border-red-900/30">
                <h2 class="hoi-header text-3xl text-red-500 text-center mb-2">–û–ë–™–Ø–í–õ–ï–ù–ò–ï –í–û–ô–ù–´</h2>
                <p class="text-center text-gray-400 text-xs mb-6 uppercase tracking-widest">–ú–∏—Ä–æ–≤–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ —Ç—Ä–µ–±—É–µ—Ç –æ–±—ä—è—Å–Ω–µ–Ω–∏–π</p>
                
                <div class="mb-4">
                    <label class="text-xs font-bold text-[#e2c08d] block mb-2">CASUS BELLI (–ü–û–í–û–î –ö –í–û–ô–ù–ï)</label>
                    <textarea id="war-reason" rows="4" class="w-full bg-black border border-gray-700 p-3 text-sm text-gray-300 focus:border-red-500 outline-none" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É (–Ω–∞–ø—Ä. '–í–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –∑–µ–º–µ–ª—å' –∏–ª–∏ '–ü—Ä–µ–≤–µ–Ω—Ç–∏–≤–Ω—ã–π —É–¥–∞—Ä')..."></textarea>
                </div>

                <div id="ai-analysis" class="hidden mb-4 p-3 bg-black/40 border-l-2 border-yellow-600 text-xs italic text-gray-400">
                    <span class="text-yellow-600 font-bold not-italic">–ì–ï–ù–®–¢–ê–ë –ê–ù–ê–õ–ò–ó–ò–†–£–ï–¢:</span> <span id="ai-text">...</span>
                </div>

                <div class="flex gap-4 justify-center">
                    <button onclick="closeModal('war-modal')" class="hoi-btn w-32">–û–¢–ú–ï–ù–ê</button>
                    <button id="btn-confirm-war" onclick="confirmWar()" class="hoi-btn hoi-btn-red w-48 shadow-red-900/50">–û–¢–ü–†–ê–í–ò–¢–¨ –£–õ–¨–¢–ò–ú–ê–¢–£–ú</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–ö–ê –õ–ï–ù–î-–õ–ò–ó–ê -->
    <div id="lend-lease-modal" class="fixed inset-0 bg-black/80 z-[2000] hidden items-center justify-center">
        <div class="hoi-panel w-[500px] p-6">
            <h3 class="hoi-header text-2xl text-[#e2c08d] mb-4">–õ–ï–ù–î-–õ–ò–ó</h3>
            <p class="text-xs text-gray-400 mb-4">–û—Ç–ø—Ä–∞–≤–∫–∞ –≤–æ–µ–Ω–Ω–æ–≥–æ —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è –∏ —Ä–µ—Å—É—Ä—Å–æ–≤ —Å–æ—é–∑–Ω–∏–∫—É.</p>
            
            <div class="space-y-4 mb-6">
                <div>
                    <div class="flex justify-between text-xs mb-1"><span>–ü–µ—Ö–æ—Ç–Ω–æ–µ —Å–Ω–∞—Ä—è–∂–µ–Ω–∏–µ</span><span>1000 –µ–¥.</span></div>
                    <input type="range" class="w-full accent-[#e2c08d] h-2 bg-black rounded appearance-none cursor-pointer">
                </div>
                <div>
                    <div class="flex justify-between text-xs mb-1"><span>–¢–∞–Ω–∫–∏</span><span>50 –µ–¥.</span></div>
                    <input type="range" class="w-full accent-[#e2c08d] h-2 bg-black rounded appearance-none cursor-pointer">
                </div>
            </div>
            
            <div class="flex justify-end gap-2">
                <button onclick="closeModal('lend-lease-modal')" class="hoi-btn">–ó–∞–∫—Ä—ã—Ç—å</button>
                <button onclick="sendLendLease()" class="hoi-btn hoi-btn-green">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω–≤–æ–π</button>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = ""; // –í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –∫–ª—é—á, –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –±—É–¥–µ—Ç —ç–º—É–ª—è—Ü–∏—è

        // --- –ë–ê–ó–ê –î–ê–ù–ù–´–• 30 –°–¢–†–ê–ù ---
        const COUNTRIES = [
            // –ú–∞–∂–æ—Ä—ã
            { id: "RUS", name: "–†–æ—Å—Å–∏—è", leader: "–í–ª–∞–¥–∏–º–∏—Ä –ü—É—Ç–∏–Ω", ideology: "neutrality", gdp: 260, army: 1200, stab: 65, color: "#4a6b4a", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/c2/Vladimir_Putin_2024.jpg/220px-Vladimir_Putin_2024.jpg", flag: "ru", desc: "–°—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –ø–æ—Å—Ç—Å–æ–≤–µ—Ç—Å–∫–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ." },
            { id: "USA", name: "–°–®–ê", leader: "–ë–∏–ª–ª –ö–ª–∏–Ω—Ç–æ–Ω", ideology: "democracy", gdp: 10200, army: 1400, stab: 90, color: "#1a3a6a", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d3/Bill_Clinton.jpg/220px-Bill_Clinton.jpg", flag: "us", desc: "–ú–∏—Ä–æ–≤–æ–π –≥–µ–≥–µ–º–æ–Ω, –≥–∞—Ä–∞–Ω—Ç –¥–µ–º–æ–∫—Ä–∞—Ç–∏–∏ –∏ —Å–≤–æ–±–æ–¥–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏." },
            { id: "CHN", name: "–ö–∏—Ç–∞–π", leader: "–¶–∑—è–Ω –¶–∑—ç–º–∏–Ω—å", ideology: "communism", gdp: 1200, army: 2200, stab: 88, color: "#8a2a2a", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/65/Jiang_Zemin_2002.jpg/220px-Jiang_Zemin_2002.jpg", flag: "cn", desc: "–°–ø—è—â–∏–π –¥—Ä–∞–∫–æ–Ω, –Ω–∞—Ä–∞—â–∏–≤–∞—é—â–∏–π —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫—É—é –∏ –≤–æ–µ–Ω–Ω—É—é –º–æ—â—å." },
            { id: "DEU", name: "–ì–µ—Ä–º–∞–Ω–∏—è", leader: "–ì–µ—Ä—Ö–∞—Ä–¥ –®—Ä—ë–¥–µ—Ä", ideology: "democracy", gdp: 1950, army: 300, stab: 85, color: "#333", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4b/Gerhard_Schroeder_2005.jpg/220px-Gerhard_Schroeder_2005.jpg", flag: "de", desc: "–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–µ —Å–µ—Ä–¥—Ü–µ –ï–≤—Ä–æ–ø—ã." },
            { id: "GBR", name: "–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è", leader: "–¢–æ–Ω–∏ –ë–ª—ç—Ä", ideology: "democracy", gdp: 1600, army: 210, stab: 80, color: "#384a8c", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/c5/Tony_Blair_%282002%29.jpg/220px-Tony_Blair_%282002%29.jpg", flag: "gb", desc: "–í–µ—Ä–Ω—ã–π —Å–æ—é–∑–Ω–∏–∫ –°–®–ê —Å —Å–∏–ª—å–Ω—ã–º —Ñ–ª–æ—Ç–æ–º." },
            { id: "FRA", name: "–§—Ä–∞–Ω—Ü–∏—è", leader: "–ñ–∞–∫ –®–∏—Ä–∞–∫", ideology: "democracy", gdp: 1500, army: 250, stab: 75, color: "#385e8c", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/73/Jacques_Chirac_2003.jpg/220px-Jacques_Chirac_2003.jpg", flag: "fr", desc: "–õ–∏–¥–µ—Ä –ï–°, —Å—Ç—Ä–µ–º—è—â–∏–π—Å—è –∫ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–π –ø–æ–ª–∏—Ç–∏–∫–µ." },
            
            // –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ
            { id: "UKR", name: "–£–∫—Ä–∞–∏–Ω–∞", leader: "–õ–µ–æ–Ω–∏–¥ –ö—É—á–º–∞", ideology: "neutrality", gdp: 32, army: 300, stab: 55, color: "#3d6e8a", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/00/Leonid_Kuchma_2003.jpg/220px-Leonid_Kuchma_2003.jpg", flag: "ua", desc: "–ë–∞–ª–∞–Ω—Å–∏—Ä—É–µ—Ç –º–µ–∂–¥—É –í–æ—Å—Ç–æ–∫–æ–º –∏ –ó–∞–ø–∞–¥–æ–º." },
            { id: "JPN", name: "–Ø–ø–æ–Ω–∏—è", leader: "–Å—Å–∏—Ä–æ –ú–æ—Ä–∏", ideology: "democracy", gdp: 4800, army: 240, stab: 95, color: "#8c8c8c", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/61/Mori_Yoshiro_20000721.jpg/220px-Mori_Yoshiro_20000721.jpg", flag: "jp", desc: "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –≥–∏–≥–∞–Ω—Ç —Å —Å–∏–ª—å–Ω—ã–º —Ñ–ª–æ—Ç–æ–º." },
            { id: "IND", name: "–ò–Ω–¥–∏—è", leader: "–ê—Ç–∞–ª –í–∞–¥–∂–ø–∞–∏", ideology: "democracy", gdp: 460, army: 1300, stab: 60, color: "#a65c1a", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/Atal_Bihari_Vajpayee.jpg/220px-Atal_Bihari_Vajpayee.jpg", flag: "in", desc: "–†–∞—Å—Ç—É—â–∞—è —è–¥–µ—Ä–Ω–∞—è –¥–µ—Ä–∂–∞–≤–∞." },
            { id: "ITA", name: "–ò—Ç–∞–ª–∏—è", leader: "–ö–∞—Ä–ª–æ –ß–∞–º–ø–∏", ideology: "democracy", gdp: 1100, army: 190, stab: 65, color: "#3a7a4a", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/e0/Carlo_Azeglio_Ciampi_1999.jpg/220px-Carlo_Azeglio_Ciampi_1999.jpg", flag: "it", desc: "–ö—É–ª—å—Ç—É—Ä–Ω—ã–π —Ü–µ–Ω—Ç—Ä —Å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–π –ø–æ–ª–∏—Ç–∏–∫–æ–π." },
            { id: "TUR", name: "–¢—É—Ä—Ü–∏—è", leader: "–ê—Ö–º–µ—Ç –°–µ–∑–µ—Ä", ideology: "neutrality", gdp: 270, army: 500, stab: 55, color: "#7a2a2a", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Ahmet_Necdet_Sezer_2002.jpg/220px-Ahmet_Necdet_Sezer_2002.jpg", flag: "tr", desc: "–°—Ç—Ä–∞–∂ –ø—Ä–æ–ª–∏–≤–æ–≤ –∏ –º–æ—Å—Ç –º–µ–∂–¥—É –ï–≤—Ä–æ–ø–æ–π –∏ –ê–∑–∏–µ–π." },
            { id: "IRN", name: "–ò—Ä–∞–Ω", leader: "–ú–æ—Ö–∞–º–º–∞–¥ –•–∞—Ç–∞–º–∏", ideology: "fascism", gdp: 100, army: 550, stab: 50, color: "#3a5a4a", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/07/Mohammad_Khatami_2001.jpg/220px-Mohammad_Khatami_2001.jpg", flag: "ir", desc: "–ò—Å–ª–∞–º—Å–∫–∞—è —Ä–µ—Å–ø—É–±–ª–∏–∫–∞ –≤ –ø—Ä–æ—Ç–∏–≤–æ—Å—Ç–æ—è–Ω–∏–∏ —Å –ó–∞–ø–∞–¥–æ–º." },
            { id: "IRQ", name: "–ò—Ä–∞–∫", leader: "–°–∞–¥–¥–∞–º –•—É—Å–µ–π–Ω", ideology: "fascism", gdp: 40, army: 400, stab: 45, color: "#5a5a3a", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/41/Saddam_Hussein_portrait_2002.jpg/220px-Saddam_Hussein_portrait_2002.jpg", flag: "iq", desc: "–†–µ–∂–∏–º –ø–æ–¥ —Å–∞–Ω–∫—Ü–∏—è–º–∏, –æ–±–ª–∞–¥–∞—é—â–∏–π –Ω–µ—Ñ—Ç—å—é." },
            { id: "SAU", name: "–°–∞—É–¥. –ê—Ä–∞–≤–∏—è", leader: "–ö–æ—Ä–æ–ª—å –§–∞—Ö–¥", ideology: "fascism", gdp: 190, army: 200, stab: 80, color: "#2a5a2a", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/30/Fahd_bin_Abdulaziz_Al_Saud_1985.jpg/220px-Fahd_bin_Abdulaziz_Al_Saud_1985.jpg", flag: "sa", desc: "–ù–µ—Ñ—Ç—è–Ω–∞—è –º–æ–Ω–∞—Ä—Ö–∏—è –∏ —Å–æ—é–∑–Ω–∏–∫ –°–®–ê." },
            { id: "ISR", name: "–ò–∑—Ä–∞–∏–ª—å", leader: "–≠—Ö—É–¥ –ë–∞—Ä–∞–∫", ideology: "democracy", gdp: 130, army: 170, stab: 70, color: "#2a3a6a", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/e0/Ehud_Barak_2000.jpg/220px-Ehud_Barak_2000.jpg", flag: "il", desc: "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–Ω—ã–π —Ñ–æ—Ä–ø–æ—Å—Ç –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏ –≤—Ä–∞–≥–æ–≤." },
            
            // –î—Ä—É–≥–∏–µ
            { id: "BRA", name: "–ë—Ä–∞–∑–∏–ª–∏—è", leader: "–§. –ö–∞—Ä–¥–æ–∑—É", ideology: "democracy", gdp: 650, army: 300, stab: 60, color: "#2a6a3a", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/b/b3/Fhc-1.jpg/220px-Fhc-1.jpg", flag: "br", desc: "–õ–∏–¥–µ—Ä –Æ–∂–Ω–æ–π –ê–º–µ—Ä–∏–∫–∏." },
            { id: "KAZ", name: "–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω", leader: "–ù. –ù–∞–∑–∞—Ä–±–∞–µ–≤", ideology: "neutrality", gdp: 20, army: 60, stab: 80, color: "#2a6a6a", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/23/Nursultan_Nazarbayev_2013.jpg/220px-Nursultan_Nazarbayev_2013.jpg", flag: "kz", desc: "–ë–æ–≥–∞—Ç—ã–µ —Ä–µ—Å—É—Ä—Å—ã –∏ –º–Ω–æ–≥–æ–≤–µ–∫—Ç–æ—Ä–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞." },
            { id: "BLR", name: "–ë–µ–ª–∞—Ä—É—Å—å", leader: "–ê. –õ—É–∫–∞—à–µ–Ω–∫–æ", ideology: "fascism", gdp: 12, army: 50, stab: 85, color: "#3a6a3a", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/07/Alexander_Lukashenko_2018.jpg/220px-Alexander_Lukashenko_2018.jpg", flag: "by", desc: "–í–µ—Ä–Ω—ã–π —Å–æ—é–∑–Ω–∏–∫ –†–æ—Å—Å–∏–∏." },
            { id: "PRK", name: "–ö–ù–î–†", leader: "–ö–∏–º –ß–µ–Ω –ò—Ä", ideology: "communism", gdp: 10, army: 1100, stab: 95, color: "#7a1a1a", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/cf/Kim_Jong_Il_2000.jpg/220px-Kim_Jong_Il_2000.jpg", flag: "kp", desc: "–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ-–∫—Ä–µ–ø–æ—Å—Ç—å." },
            { id: "KOR", name: "–Æ–∂. –ö–æ—Ä–µ—è", leader: "–ö–∏–º –î—ç –ß–∂—É–Ω", ideology: "democracy", gdp: 560, army: 600, stab: 80, color: "#1a2a5a", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/Kim_Dae-jung_2000.jpg/220px-Kim_Dae-jung_2000.jpg", flag: "kr", desc: "–ê–∑–∏–∞—Ç—Å–∫–∏–π —Ç–∏–≥—Ä." },
            { id: "CAN", name: "–ö–∞–Ω–∞–¥–∞", leader: "–ñ–∞–Ω –ö—Ä–µ—Ç—å–µ–Ω", ideology: "democracy", gdp: 740, army: 60, stab: 90, color: "#8a2a2a", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/b/be/Jean_Chretien_1994.jpg/220px-Jean_Chretien_1994.jpg", flag: "ca", desc: "–ú–∏—Ä–Ω—ã–π —Å–µ–≤–µ—Ä–Ω—ã–π —Å–æ—Å–µ–¥ –°–®–ê." },
            { id: "AUS", name: "–ê–≤—Å—Ç—Ä–∞–ª–∏—è", leader: "–î–∂–æ–Ω –ì–æ–≤–∞—Ä–¥", ideology: "democracy", gdp: 415, army: 55, stab: 90, color: "#1a2a6a", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/23/John_Howard_2003.jpg/220px-John_Howard_2003.jpg", flag: "au", desc: "–°—Ç—Ä–∞–∂ –¢–∏—Ö–æ–≥–æ –æ–∫–µ–∞–Ω–∞." },
            { id: "POL", name: "–ü–æ–ª—å—à–∞", leader: "–ê. –ö–≤–∞—Å—å–Ω–µ–≤—Å–∫–∏–π", ideology: "democracy", gdp: 170, army: 120, stab: 75, color: "#8a4a4a", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/Aleksander_Kwasniewski_2002.jpg/220px-Aleksander_Kwasniewski_2002.jpg", flag: "pl", desc: "–í–æ—Å—Ç–æ—á–Ω—ã–π —Ñ–ª–∞–Ω–≥ –ù–ê–¢–û." },
            { id: "ESP", name: "–ò—Å–ø–∞–Ω–∏—è", leader: "–•–æ—Å–µ –ê—Å–Ω–∞—Ä", ideology: "democracy", gdp: 600, army: 130, stab: 70, color: "#8a7a2a", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/Jos%C3%A9_Mar%C3%ADa_Aznar_2003.jpg/220px-Jos%C3%A9_Mar%C3%ADa_Aznar_2003.jpg", flag: "es", desc: "–†–∞–∑–≤–∏–≤–∞—é—â–∞—è—Å—è —ç–∫–æ–Ω–æ–º–∏–∫–∞ –Æ–≥–∞ –ï–≤—Ä–æ–ø—ã." },
            { id: "SWE", name: "–®–≤–µ—Ü–∏—è", leader: "–ô. –ü–µ—Ä—Å—Å–æ–Ω", ideology: "democracy", gdp: 260, army: 30, stab: 95, color: "#2a4a7a", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4c/G%C3%B6ran_Persson_2006-03-24.jpg/220px-G%C3%B6ran_Persson_2006-03-24.jpg", flag: "se", desc: "–°–∫–∞–Ω–¥–∏–Ω–∞–≤—Å–∫–∏–π –Ω–µ–π—Ç—Ä–∞–ª–∏—Ç–µ—Ç." },
            { id: "IDN", name: "–ò–Ω–¥–æ–Ω–µ–∑–∏—è", leader: "–ê. –í–∞—Ö–∏–¥", ideology: "democracy", gdp: 165, army: 300, stab: 45, color: "#8a3a3a", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/41/Abdurrahman_Wahid_2000.jpg/220px-Abdurrahman_Wahid_2000.jpg", flag: "id", desc: "–ö—Ä—É–ø–Ω–µ–π—à–∞—è –º—É—Å—É–ª—å–º–∞–Ω—Å–∫–∞—è –¥–µ–º–æ–∫—Ä–∞—Ç–∏—è." },
            { id: "PAK", name: "–ü–∞–∫–∏—Å—Ç–∞–Ω", leader: "–ü. –ú—É—à–∞—Ä—Ä–∞—Ñ", ideology: "fascism", gdp: 75, army: 600, stab: 40, color: "#2a5a3a", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/7a/Pervez_Musharraf_2004.jpg/220px-Pervez_Musharraf_2004.jpg", flag: "pk", desc: "–Ø–¥–µ—Ä–Ω–∞—è –¥–µ—Ä–∂–∞–≤–∞ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –∫—Ä–∏–∑–∏—Å–∞." },
            { id: "VNM", name: "–í—å–µ—Ç–Ω–∞–º", leader: "–¢—Ä–∞–Ω –î—É–∫ –õ—É–æ–Ω–≥", ideology: "communism", gdp: 33, army: 480, stab: 80, color: "#8a1a1a", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/21/Tran_Duc_Luong_2005.jpg/220px-Tran_Duc_Luong_2005.jpg", flag: "vn", desc: "–ê–∑–∏–∞—Ç—Å–∫–∏–π —Ç–∏–≥—Ä –Ω–∞ —Å—Ç–∞—Ä—Ç–µ." },
            { id: "ARG", name: "–ê—Ä–≥–µ–Ω—Ç–∏–Ω–∞", leader: "–§. –¥–µ –ª–∞ –†—É–∞", ideology: "democracy", gdp: 285, army: 70, stab: 40, color: "#3a7a9a", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/41/Fernando_de_la_Rua_2000.jpg/220px-Fernando_de_la_Rua_2000.jpg", flag: "ar", desc: "–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏." },
            { id: "EGY", name: "–ï–≥–∏–ø–µ—Ç", leader: "–•–æ—Å–Ω–∏ –ú—É–±–∞—Ä–∞–∫", ideology: "neutrality", gdp: 100, army: 450, stab: 60, color: "#6a5a3a", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/23/Hosni_Mubarak_2009.jpg/220px-Hosni_Mubarak_2009.jpg", flag: "eg", desc: "–õ–∏–¥–µ—Ä –∞—Ä–∞–±—Å–∫–æ–≥–æ –º–∏—Ä–∞." }
        ];

        let gameState = {
            player: null,
            target: null,
            date: new Date(2000, 0, 1)
        };

        // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
        window.onload = async () => {
            await initMap();
            renderList();
        };

        async function initMap() {
            const svg = d3.select("#world-map");
            const width = window.innerWidth;
            const height = window.innerHeight;

            try {
                const res = await fetch('https://cdn.jsdelivr.net/npm/world-atlas@2.0.2/countries-110m.json');
                const data = await res.json();
                const features = topojson.feature(data, data.objects.countries).features;

                const projection = d3.geoMercator().scale(width / 6.5).translate([width/2.2, height/1.8]);
                const path = d3.geoPath().projection(projection);

                svg.append("g")
                    .selectAll("path")
                    .data(features)
                    .enter()
                    .append("path")
                    .attr("d", path)
                    .attr("class", "province")
                    .attr("id", d => {
                        // –ü–æ–ø—ã—Ç–∫–∞ –º–∞–ø–ø–∏–Ω–≥–∞ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–¥–ª—è –¥–µ–º–æ)
                        const dbMatch = COUNTRIES.find(c => c.name === d.properties.name || mapName(d.properties.name) === c.id);
                        return dbMatch ? dbMatch.id : "UNK";
                    })
                    .attr("fill", d => {
                        const dbMatch = COUNTRIES.find(c => c.name === d.properties.name || mapName(d.properties.name) === c.id);
                        return dbMatch ? dbMatch.color : "#1a1e24";
                    })
                    .on("click", function(e, d) {
                        const dbMatch = COUNTRIES.find(c => c.name === d.properties.name || mapName(d.properties.name) === c.id);
                        if (dbMatch) {
                            if (!gameState.player) selectCountry(dbMatch); // –í –º–µ–Ω—é
                            else openDiplomacy(dbMatch); // –í –∏–≥—Ä–µ
                        }
                    });

            } catch (e) { console.error("Map Error", e); }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –º–∞–ø–ø–∏–Ω–≥–∞ –Ω–∞–∑–≤–∞–Ω–∏–π GeoJSON –∫ ID
        function mapName(name) {
            const map = { "Russia": "RUS", "United States of America": "USA", "China": "CHN", "Germany": "DEU", "Ukraine": "UKR", "France": "FRA", "United Kingdom": "GBR", "Japan": "JPN", "India": "IND", "Brazil": "BRA", "Italy": "ITA", "Turkey": "TUR", "Kazakhstan": "KAZ", "Belarus": "BLR", "Canada": "CAN", "Australia": "AUS", "Spain": "ESP", "Poland": "POL", "Sweden": "SWE", "Norway": "NOR", "Finland": "FIN", "Iran": "IRN", "Iraq": "IRQ", "Saudi Arabia": "SAU", "Israel": "ISR", "South Korea": "KOR", "North Korea": "PRK", "Egypt": "EGY", "Pakistan": "PAK", "Vietnam": "VNM", "Indonesia": "IDN", "Argentina": "ARG" };
            return map[name];
        }

        // --- –ú–ï–ù–Æ –í–´–ë–û–†–ê ---
        function renderList() {
            const list = document.getElementById('country-list');
            COUNTRIES.forEach(c => {
                const el = document.createElement('div');
                el.className = "p-2 bg-white/5 border border-white/5 hover:bg-yellow-600/20 cursor-pointer flex items-center justify-between";
                el.innerHTML = `
                    <div class="flex items-center gap-2">
                        <img src="https://flagcdn.com/w40/${c.flag}.png" class="w-6 h-4 border border-black">
                        <span class="text-xs font-bold text-gray-300">${c.name}</span>
                    </div>
                    <span class="text-[8px] uppercase text-gray-500">${c.ideology}</span>
                `;
                el.onclick = () => selectCountry(c);
                list.appendChild(el);
            });
        }

        function selectCountry(c) {
            gameState.player = c;
            
            document.getElementById('p-name').innerText = c.name;
            document.getElementById('p-ideology').innerText = c.ideology;
            document.getElementById('p-flag').src = `https://flagcdn.com/w160/${c.flag}.png`;
            
            document.getElementById('p-leader-name').innerText = c.leader;
            document.getElementById('p-leader-img').src = c.img;
            document.getElementById('p-desc').innerText = c.desc;
            
            document.getElementById('p-gdp').innerText = `$${c.gdp}B`;
            document.getElementById('p-army').innerText = `${c.army}K`;
            document.getElementById('p-stab').innerText = `${c.stab}%`;
            
            document.getElementById('empty-state').classList.add('hidden');
            document.getElementById('preview-content').classList.remove('hidden');
        }

        function startGame() {
            document.getElementById('setup-screen').classList.add('hidden');
            document.getElementById('game-ui').classList.remove('hidden');
            
            // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ UI
            const p = gameState.player;
            document.getElementById('ui-flag').src = `https://flagcdn.com/w40/${p.flag}.png`;
            document.getElementById('ui-name').innerText = p.name;
            document.getElementById('ui-leader-name').innerText = p.leader;
            document.getElementById('ui-ideology-name').innerText = p.ideology;
            
            document.getElementById('res-money').innerText = `$${p.gdp / 5}B`; // –£—Å–ª–æ–≤–Ω–æ –±—é–¥–∂–µ—Ç
            document.getElementById('res-army').innerText = `${p.army}K`;
            document.getElementById('res-stab').innerText = `${p.stab}%`;
            
            addEvent("–í—ã –ø—Ä–∏–Ω—è–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ–º. –ú–∏—Ä –æ–∂–∏–¥–∞–µ—Ç –≤–∞—à–∏—Ö —Ä–µ—à–µ–Ω–∏–π.");
        }

        // --- –î–ò–ü–õ–û–ú–ê–¢–ò–Ø –ò –í–û–ô–ù–ê ---
        function openDiplomacy(target) {
            if (target.id === gameState.player.id) return;
            
            gameState.target = target;
            const panel = document.getElementById('diplomacy-panel');
            panel.classList.remove('hidden');
            
            document.getElementById('diplo-flag').src = `https://flagcdn.com/w80/${target.flag}.png`;
            document.getElementById('diplo-name').innerText = target.name;
            document.getElementById('diplo-leader').innerText = target.leader;
            document.getElementById('diplo-ideology').innerText = target.ideology;
            document.getElementById('diplo-opinion').innerText = "+10"; // –ó–∞–≥–ª—É—à–∫–∞
            document.getElementById('diplo-army').innerText = `${target.army}K`;
            document.getElementById('diplo-ind').innerText = `${Math.floor(target.gdp / 10)} —Ñ–±.`;
            document.getElementById('diplo-leader-img').src = target.img;
        }

        function closeDiplo() {
            document.getElementById('diplomacy-panel').classList.add('hidden');
        }

        // –î–µ–π—Å—Ç–≤–∏—è
        function diploAction(action) {
            if (!gameState.target) return;
            const t = gameState.target;
            const p = gameState.player;

            if (action === 'war_goal') {
                showModal('war');
            } else if (action === 'alliance') {
                if (t.ideology === p.ideology) {
                    addEvent(`–ê–ª—å—è–Ω—Å —Å ${t.name} –∑–∞–∫–ª—é—á–µ–Ω! (–°—Ö–æ–∂–∞—è –∏–¥–µ–æ–ª–æ–≥–∏—è)`);
                } else {
                    addEvent(`${t.name} –æ—Ç–∫–ª–æ–Ω–∏–ª–∞ –∞–ª—å—è–Ω—Å (–†–∞–∑–Ω—ã–µ –≤–∑–≥–ª—è–¥—ã)`);
                }
            } else if (action === 'lend_lease') {
                showModal('lend');
            } else if (action === 'improve') {
                addEvent(`–ù–∞—á–∞—Ç–æ —É–ª—É—á—à–µ–Ω–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Å ${t.name}. (-10 PP)`);
            } else if (action === 'trade') {
                addEvent(`–¢–æ—Ä–≥–æ–≤–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ —Å ${t.name} –ø–æ–¥–ø–∏—Å–∞–Ω–æ.`);
            }
        }

        // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
        function showModal(type) {
            const modal = document.getElementById('modal-overlay');
            const war = document.getElementById('modal-war');
            const lend = document.getElementById('modal-lend');
            
            modal.classList.remove('hidden');
            war.classList.add('hidden');
            lend.classList.add('hidden');
            
            if (type === 'war') {
                war.classList.remove('hidden');
                document.getElementById('war-target-name').innerText = gameState.target.name;
                document.getElementById('war-analysis').classList.add('hidden');
                document.getElementById('btn-send-war').innerText = "–û–¢–ü–†–ê–í–ò–¢–¨ –£–õ–¨–¢–ò–ú–ê–¢–£–ú";
                document.getElementById('btn-send-war').disabled = false;
            } else if (type === 'lend') {
                lend.classList.remove('hidden');
            }
        }

        function closeModal() {
            document.getElementById('modal-overlay').classList.add('hidden');
        }

        // --- –ù–ï–ô–†–û–°–ï–¢–¨ (–≠–º—É–ª—è—Ü–∏—è) ---
        async function analyzeWarGoal() {
            const reason = document.getElementById('war-reason').value;
            if (reason.length < 5) return;

            const btn = document.getElementById('btn-send-war');
            const analysis = document.getElementById('war-analysis');
            const output = document.getElementById('ai-text');

            btn.disabled = true;
            btn.innerText = "–ê–ù–ê–õ–ò–ó –ì–ï–ù–®–¢–ê–ë–ê...";
            analysis.classList.remove('hidden');
            output.innerText = "–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö...";

            // –≠–º—É–ª—è—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –ò–ò (–í —Ä–µ–∞–ª–µ —Ç—É—Ç fetch –∫ API)
            // –ü—Ä–æ–º–ø—Ç –¥–ª—è –ò–ò –±—ã–ª –±—ã: "–ò–≥—Ä–æ–∫ —Ö–æ—á–µ—Ç –Ω–∞–ø–∞—Å—Ç—å –Ω–∞ [–°—Ç—Ä–∞–Ω–∞] –ø–æ –ø—Ä–∏—á–∏–Ω–µ [–ü—Ä–∏—á–∏–Ω–∞]. –û—Ü–µ–Ω–∏ –ª–µ–≥–∏—Ç–∏–º–Ω–æ—Å—Ç—å –∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è."
            
            setTimeout(() => {
                const legitimacy = Math.random() > 0.5;
                const tension = Math.floor(Math.random() * 10) + 5;
                
                let response = "";
                if (reason.toLowerCase().includes("–∑–µ–º–ª") || reason.toLowerCase().includes("–≤–µ—Ä–Ω—É—Ç—å")) {
                    response = "–†–µ–≤–∞–Ω—à–∏–∑–º. –ù–∞—Ä–æ–¥ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç, –Ω–æ –û–û–ù –æ—Å—É–¥–∏—Ç. –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å +5%, –ú–∏—Ä–æ–≤–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ +" + tension + "%.";
                } else if (reason.toLowerCase().includes("—Ç–µ—Ä—Ä–æ—Ä") || reason.toLowerCase().includes("–∑–∞—â–∏—Ç")) {
                    response = "–û–ø–µ—Ä–∞—Ü–∏—è –ø–æ –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—é –º–∏—Ä–∞. –õ–µ–≥–∏—Ç–∏–º–Ω–æ. –°–æ—é–∑–Ω–∏–∫–∏ –º–æ–≥—É—Ç –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å.";
                } else {
                    response = "–ê–≥—Ä–µ—Å—Å–∏—è –±–µ–∑ –≤–µ—Å–∫–æ–π –ø—Ä–∏—á–∏–Ω—ã. –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ —Å–∞–Ω–∫—Ü–∏–π –∏ —ç–º–±–∞—Ä–≥–æ. –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å -10%.";
                }

                output.innerText = response;
                btn.innerText = "–û–ë–™–Ø–í–ò–¢–¨ –í–û–ô–ù–£";
                btn.disabled = false;
                btn.onclick = () => {
                    addEvent(`–í–û–ô–ù–ê! –ú—ã –∞—Ç–∞–∫–æ–≤–∞–ª–∏ ${gameState.target.name}. –ü–æ–≤–æ–¥: "${reason}".`);
                    d3.select(`#${gameState.target.id}`).style("fill", "#8b0000"); // –ö—Ä–∞—Å–∏–º –≤—Ä–∞–≥–∞
                    closeModal();
                };
            }, 1500);
        }

        function sendLendLease() {
            addEvent(`–ö–æ–Ω–≤–æ–π —Å –ø–æ–º–æ—â—å—é –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ ${gameState.target.name}.`);
            closeModal();
        }

        function addEvent(text) {
            const log = document.getElementById('event-log');
            const div = document.createElement('div');
            div.className = "text-gray-400 mb-1 border-l-2 border-yellow-600 pl-2";
            div.innerHTML = `<span class="text-yellow-600">[${new Date().toLocaleTimeString()}]</span> ${text}`;
            log.prepend(div);
        }

        function endTurn() {
            // –≠–º—É–ª—è—Ü–∏—è —Ö–æ–¥–∞
            gameState.date.setMonth(gameState.date.getMonth() + 1);
            document.getElementById('ui-date').innerText = gameState.date.toLocaleString('ru', { month: 'short', year: 'numeric' });
            
            // –†–∞–Ω–¥–æ–º–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ
            if (Math.random() > 0.7) {
                const evs = [
                    "–†–æ—Å—Ç —Ü–µ–Ω –Ω–∞ –Ω–µ—Ñ—Ç—å —É–∫—Ä–µ–ø–∏–ª –±—é–¥–∂–µ—Ç.",
                    "–ü—Ä–æ—Ç–µ—Å—Ç—ã –æ–ø–ø–æ–∑–∏—Ü–∏–∏ –ø–æ–¥–∞–≤–ª–µ–Ω—ã.",
                    "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ä—ã–≤ –≤ —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–µ.",
                    "–ü–æ–≥—Ä–∞–Ω–∏—á–Ω—ã–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç –≤ –ê–∑–∏–∏."
                ];
                addEvent(evs[Math.floor(Math.random() * evs.length)]);
            }
        }

    </script>
</body>
</html>
