<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruina Lider: Mega Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Montserrat:wght@400;700;900&display=swap');

        :root {
            --primary: #10b981;
            --danger: #ef4444;
            --bg: #020617;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--bg);
            color: #f1f5f9;
            margin: 0;
            overflow: hidden;
        }

        .mono { font-family: 'JetBrains Mono', monospace; }

        .glass {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* –ö–∞—Ä—Ç–∞ */
        .country {
            stroke: rgba(255, 255, 255, 0.1);
            stroke-width: 0.5;
            transition: all 0.3s;
            cursor: pointer;
        }

        .country:hover {
            stroke: #fff;
            stroke-width: 1.5;
            filter: brightness(1.3);
        }

        .selected {
            stroke: #fbbf24;
            stroke-width: 2.5;
        }

        .player-country {
            stroke: var(--primary);
            stroke-width: 2;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è —è–¥–µ—Ä–Ω–æ–≥–æ –≤–∑—Ä—ã–≤–∞ */
        @keyframes nuke-shake {
            0% { transform: translate(0, 0); }
            10% { transform: translate(-5px, 5px); }
            30% { transform: translate(5px, -5px); }
            50% { transform: translate(-5px, 0); }
            100% { transform: translate(0, 0); }
        }

        .nuke-active { animation: nuke-shake 0.5s infinite; }

        /* –°—Ç–∏–ª–∏ –ª–æ–≥–∞ */
        .log-entry {
            border-left: 2px solid #334155;
            padding-left: 8px;
            margin-bottom: 8px;
            font-size: 0.75rem;
        }

        /* –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ */
        .tech-node {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.2s;
        }
        .tech-node.unlocked {
            border-color: var(--primary);
            background: rgba(16, 185, 129, 0.1);
        }
        
        .tab-btn.active {
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
        }
    </style>
</head>
<body class="w-screen h-screen select-none">

    <!-- SETUP SCREEN -->
    <div id="setup-screen" class="fixed inset-0 z-50 flex items-center justify-center bg-slate-950">
        <div class="max-w-5xl w-full h-[80vh] glass rounded-3xl flex flex-col overflow-hidden shadow-2xl">
            <div class="p-8 border-b border-white/10 flex justify-between items-center">
                <div>
                    <h1 class="text-5xl font-black italic tracking-tighter">RUINA <span class="text-emerald-500">LIDER</span></h1>
                    <p class="text-[10px] text-slate-500 uppercase tracking-[0.4em] font-bold mt-1">Advanced Hegemony Protocol v4.0</p>
                </div>
                <div id="status-tag" class="px-4 py-1 bg-white/5 rounded-full text-[10px] mono text-emerald-500">SYSTEM: READY</div>
            </div>

            <div class="flex-grow flex">
                <div class="flex-grow relative bg-black/40">
                    <svg id="svg-setup" class="w-full h-full"></svg>
                    <div class="absolute bottom-4 left-4 text-[10px] text-slate-500 italic">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω—É, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å –Ω–∞—Ü–∏—é</div>
                </div>
                
                <div id="setup-panel" class="w-96 p-8 border-l border-white/10 flex flex-col gap-6 bg-slate-900/20">
                    <div id="country-preview" class="hidden space-y-6">
                        <div>
                            <span id="p-tag" class="text-[10px] font-bold text-emerald-500 mono">RUS</span>
                            <h2 id="p-name" class="text-4xl font-black italic truncate">Russia</h2>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-2">
                            <div class="p-3 bg-white/5 rounded-xl border border-white/5">
                                <div class="text-[9px] text-slate-500 uppercase font-bold">–ê—Ä–º–∏—è</div>
                                <div id="p-army" class="text-xl font-black mono text-emerald-400">0</div>
                            </div>
                            <div class="p-3 bg-white/5 rounded-xl border border-white/5">
                                <div class="text-[9px] text-slate-500 uppercase font-bold">–í–í–ü</div>
                                <div id="p-econ" class="text-xl font-black mono text-blue-400">0</div>
                            </div>
                        </div>

                        <div class="space-y-2">
                            <label class="text-[10px] text-slate-500 font-bold uppercase">–ò–¥–µ–æ–ª–æ–≥–∏—è</label>
                            <div id="p-ideo" class="p-3 bg-white/5 rounded-xl border border-white/10 flex items-center gap-3">
                                <span class="text-2xl">üö©</span>
                                <span class="font-bold text-sm">–ö–æ–º–º—É–Ω–∏–∑–º</span>
                            </div>
                        </div>

                        <button onclick="startGame()" class="w-full py-4 bg-emerald-600 hover:bg-emerald-500 text-white font-black uppercase tracking-widest rounded-xl transition-all shadow-lg shadow-emerald-600/20">
                            –ü—Ä–∏–Ω—è—Ç—å –∫–æ–º–∞–Ω–¥–æ–≤–∞–Ω–∏–µ
                        </button>
                    </div>

                    <div id="no-selection" class="flex-grow flex flex-col items-center justify-center text-center opacity-30 italic">
                        <div class="text-4xl mb-4">üåç</div>
                        <p class="text-sm">–û–∂–∏–¥–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MAIN GAME UI -->
    <div id="game-ui" class="hidden h-full flex flex-col">
        <!-- TOP HUD -->
        <header class="h-16 glass border-b border-white/10 flex items-center justify-between px-8 z-40">
            <div class="flex items-center gap-12">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-emerald-600 rounded-lg flex items-center justify-center font-black italic text-xl">R</div>
                    <div class="hidden lg:block leading-none">
                        <div class="text-sm font-black italic">RUINA LIDER</div>
                        <div class="text-[9px] text-slate-500 font-bold">MEGA EDITION</div>
                    </div>
                </div>

                <div class="flex items-center gap-8">
                    <div class="group cursor-help">
                        <div class="text-[8px] text-slate-500 font-bold uppercase tracking-tighter">–ë—é–¥–∂–µ—Ç</div>
                        <div class="flex items-center gap-2">
                            <span class="text-yellow-500 text-sm">üí∞</span>
                            <span id="res-gold" class="text-sm font-black mono">1200</span>
                        </div>
                    </div>
                    <div>
                        <div class="text-[8px] text-slate-500 font-bold uppercase tracking-tighter">–ù–µ—Ñ—Ç—å (–¢–æ–ø–ª.)</div>
                        <div class="flex items-center gap-2">
                            <span class="text-blue-400 text-sm">üõ¢Ô∏è</span>
                            <span id="res-oil" class="text-sm font-black mono">100</span>
                        </div>
                    </div>
                    <div>
                        <div class="text-[8px] text-slate-500 font-bold uppercase tracking-tighter">–ü–æ–ª–∏—Ç. –≤–ª–∏—è–Ω–∏–µ</div>
                        <div class="flex items-center gap-2">
                            <span class="text-emerald-400 text-sm">‚ö°</span>
                            <span id="res-pp" class="text-sm font-black mono">50</span>
                        </div>
                    </div>
                    <div id="nuke-counter-container" class="hidden">
                        <div class="text-[8px] text-red-500 font-bold uppercase tracking-tighter">–Ø–¥–µ—Ä–Ω—ã–π –∞—Ä—Å–µ–Ω–∞–ª</div>
                        <div class="flex items-center gap-2">
                            <span class="text-red-500 text-sm animate-pulse">‚ò¢Ô∏è</span>
                            <span id="res-nukes" class="text-sm font-black mono text-red-500">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex items-center gap-6">
                <div class="text-right mr-4">
                    <div id="game-date" class="text-sm font-black mono tracking-tighter">01 JAN 1936</div>
                    <div id="game-speed-label" class="text-[9px] text-slate-500 font-bold uppercase tracking-[0.2em]">PAUSED</div>
                </div>
                <div class="flex bg-black/40 rounded-xl p-1 border border-white/5">
                    <button onclick="setSpeed(0)" class="w-9 h-9 flex items-center justify-center hover:bg-white/5 rounded-lg transition" title="–ü–∞—É–∑–∞">‚è∏</button>
                    <button onclick="setSpeed(1)" class="w-9 h-9 flex items-center justify-center hover:bg-white/5 rounded-lg transition" title="–û–±—ã—á–Ω–∞—è">‚ñ∂</button>
                    <button onclick="setSpeed(2)" class="w-9 h-9 flex items-center justify-center hover:bg-white/5 rounded-lg transition" title="–ë—ã—Å—Ç—Ä–∞—è">‚è©</button>
                </div>
            </div>
        </header>

        <main class="flex-grow flex overflow-hidden relative">
            
            <!-- WORLD MAP -->
            <div class="flex-grow relative bg-[#010409]">
                <svg id="svg-main" class="w-full h-full"></svg>
                
                <!-- NUCLEAR OVERLAY -->
                <div id="nuke-effect" class="absolute inset-0 pointer-events-none opacity-0 bg-white transition-opacity duration-100"></div>

                <!-- NOTIFICATIONS / NEWS -->
                <div id="news-ticker" class="absolute bottom-6 left-1/2 -translate-x-1/2 w-full max-w-2xl hidden">
                    <div class="glass p-4 rounded-2xl flex items-center gap-4 shadow-2xl border-emerald-500/30">
                        <div class="w-12 h-12 bg-emerald-500 rounded-lg flex items-center justify-center text-2xl">üì∞</div>
                        <div>
                            <div class="text-[10px] text-emerald-500 font-black uppercase tracking-widest">–≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π –≤—ã–ø—É—Å–∫</div>
                            <p id="news-text" class="text-sm font-bold">–ú–∏—Ä–æ–≤—ã–µ –ª–∏–¥–µ—Ä—ã –æ–±–µ—Å–ø–æ–∫–æ–µ–Ω—ã —Ä–æ—Å—Ç–æ–º –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω–æ—Å—Ç–∏ –≤ –ï–≤—Ä–æ–ø–µ.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SIDEBAR -->
            <aside class="w-[420px] glass border-l border-white/10 flex flex-col z-30 shadow-2xl overflow-hidden">
                <!-- TABS -->
                <div class="flex border-b border-white/10">
                    <button onclick="setTab('diplo')" id="btn-diplo" class="tab-btn flex-1 py-4 text-[10px] font-black uppercase tracking-widest active">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</button>
                    <button onclick="setTab('tech')" id="btn-tech" class="tab-btn flex-1 py-4 text-[10px] font-black uppercase tracking-widest">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</button>
                    <button onclick="setTab('stats')" id="btn-stats" class="tab-btn flex-1 py-4 text-[10px] font-black uppercase tracking-widest">–õ–æ–≥</button>
                </div>

                <!-- TAB: DIPLOMACY / INFO -->
                <div id="tab-content-diplo" class="flex-grow flex flex-col p-6 space-y-6 overflow-y-auto">
                    <div id="info-box" class="hidden space-y-6">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 id="info-name" class="text-3xl font-black italic truncate leading-none">United Kingdom</h3>
                                <div id="info-ideo-badge" class="mt-2 inline-block px-2 py-0.5 bg-blue-500/20 text-blue-400 border border-blue-500/20 text-[9px] font-black rounded uppercase">–î–µ–º–æ–∫—Ä–∞—Ç–∏—è</div>
                            </div>
                            <div id="info-flag" class="w-12 h-12 bg-white/5 rounded-lg flex items-center justify-center text-2xl border border-white/10">üá¨üáß</div>
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <div class="p-4 bg-white/5 rounded-2xl border border-white/5">
                                <span class="text-[9px] text-slate-500 font-bold block mb-1 uppercase">–î–∏–≤–∏–∑–∏–∏</span>
                                <div id="info-army" class="text-2xl font-black mono italic">0</div>
                            </div>
                            <div class="p-4 bg-white/5 rounded-2xl border border-white/5">
                                <span class="text-[9px] text-slate-500 font-bold block mb-1 uppercase">–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å</span>
                                <div id="info-stab" class="text-2xl font-black mono italic">85%</div>
                            </div>
                        </div>

                        <div id="player-actions" class="grid grid-cols-2 gap-3 pt-4">
                            <button onclick="actionWar()" class="p-4 bg-red-600/10 hover:bg-red-600 text-red-500 hover:text-white border border-red-500/20 rounded-2xl font-black uppercase text-[10px] transition-all">–û–±—ä—è–≤–∏—Ç—å –≤–æ–π–Ω—É</button>
                            <button onclick="actionTrade()" class="p-4 bg-blue-600/10 hover:bg-blue-600 text-blue-400 hover:text-white border border-blue-600/20 rounded-2xl font-black uppercase text-[10px] transition-all">–£–ª—É—á—à–∏—Ç—å —Å–≤—è–∑–∏</button>
                            <button id="nuke-btn" onclick="actionNuke()" class="col-span-2 p-4 bg-yellow-600/10 hover:bg-yellow-600 text-yellow-500 hover:text-white border border-yellow-500/20 rounded-2xl font-black uppercase text-[10px] hidden transition-all">–ó–∞–ø—É—Å—Ç–∏—Ç—å —è–¥–µ—Ä–Ω—ã–π —É–¥–∞—Ä ‚ò¢Ô∏è</button>
                        </div>
                    </div>
                    
                    <div id="info-placeholder" class="flex-grow flex flex-col items-center justify-center opacity-30 text-center italic">
                        <p>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—Ü–∏—é –Ω–∞ –∫–∞—Ä—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π</p>
                    </div>
                </div>

                <!-- TAB: TECH TREE -->
                <div id="tab-content-tech" class="hidden flex-grow flex flex-col p-6 space-y-6 overflow-y-auto">
                    <h3 class="text-sm font-black uppercase tracking-widest text-emerald-500">–¶–µ–Ω—Ç—Ä —Ä–∞–∑—Ä–∞–±–æ—Ç–æ–∫</h3>
                    
                    <div class="space-y-4" id="tech-list">
                        <!-- Tech nodes will be here -->
                    </div>
                </div>

                <!-- TAB: LOGS -->
                <div id="tab-content-stats" class="hidden flex-grow flex flex-col p-6 overflow-y-auto">
                    <div id="game-logs" class="mono space-y-2 text-[11px]">
                        <div class="text-emerald-500/50 italic">> –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —à—Ç–∞–±–∞...</div>
                    </div>
                </div>

                <!-- BOTTOM FOOTER -->
                <div class="p-4 bg-slate-950 border-t border-white/10 flex justify-between items-center">
                    <div class="flex items-center gap-2">
                        <div class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
                        <span class="text-[9px] font-bold text-slate-500">SERVER: SECURE</span>
                    </div>
                    <span id="fps" class="text-[9px] font-bold text-slate-700 mono">60 FPS</span>
                </div>
            </aside>
        </main>
    </div>

    <script>
        // --- DATA & CONFIG ---
        const ideos = {
            dem: { name: '–î–µ–º–æ–∫—Ä–∞—Ç–∏—è', color: '#3b82f6', icon: '‚öñÔ∏è' },
            com: { name: '–ö–æ–º–º—É–Ω–∏–∑–º', color: '#ef4444', icon: 'üö©' },
            fas: { name: '–§–∞—à–∏–∑–º', color: '#1e1b4b', icon: 'ü¶Ö' },
            aut: { name: '–ê–≤—Ç–æ—Ä–∏—Ç–∞—Ä–∏–∑–º', color: '#64748b', icon: 'üéñÔ∏è' }
        };

        const techs = [
            { id: 'ind_1', name: '–ú–∞—Å—Å–æ–≤–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ', cost: 100, type: 'econ', desc: '+15% –∫ –¥–æ—Ö–æ–¥–∞–º', unlocked: false },
            { id: 'mil_1', name: '–£–ª—É—á—à–µ–Ω–Ω—ã–µ –≤–∏–Ω—Ç–æ–≤–∫–∏', cost: 150, type: 'mil', desc: '+20% –∫ —Å–∏–ª–µ –∞—Ä–º–∏–∏', unlocked: false },
            { id: 'atom_1', name: '–ü—Ä–æ–µ–∫—Ç –ú–∞–Ω—Ö—ç—Ç—Ç–µ–Ω', cost: 500, type: 'nuke', desc: '–û—Ç–∫—Ä—ã–≤–∞–µ—Ç —è–¥–µ—Ä–Ω–æ–µ –æ—Ä—É–∂–∏–µ', unlocked: false },
            { id: 'atom_2', name: '–ü–ª—É—Ç–æ–Ω–∏–µ–≤—ã–µ –∑–∞—Ä—è–¥—ã', cost: 1000, type: 'nuke', desc: '–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ –±–æ–º–±', unlocked: false }
        ];

        let countries = [];
        let player = null;
        let selected = null;
        let gameSpeed = 0;
        let gameDate = new Date(1936, 0, 1);
        let resources = { gold: 1000, oil: 100, pp: 50, nukes: 0, techPoints: 0 };
        let currentTab = 'diplo';
        let isNuclearWar = false;

        const projection = d3.geoMercator().scale(160).translate([450, 400]);
        const path = d3.geoPath().projection(projection);

        // --- CORE INITIALIZATION ---

        async function init() {
            try {
                const res = await fetch('https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson');
                const data = await res.json();
                
                countries = data.features.map(f => {
                    const ideoKey = Object.keys(ideos)[Math.floor(Math.random() * 4)];
                    return {
                        id: f.id,
                        name: f.properties.name,
                        feature: f,
                        ideology: ideos[ideoKey],
                        army: Math.floor(Math.random() * 500) + 50,
                        econ: Math.floor(Math.random() * 1500) + 200,
                        stability: 50 + Math.floor(Math.random() * 40),
                        relations: 0,
                        atWar: false,
                        isDestroyed: false
                    };
                });

                renderSetupMap();
            } catch (err) {
                console.error("Critical Load Error", err);
                alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç—ã.");
            }
        }

        function renderSetupMap() {
            const svg = d3.select("#svg-setup");
            const g = svg.append("g");

            g.selectAll("path")
                .data(countries)
                .enter()
                .append("path")
                .attr("d", path)
                .attr("class", "country")
                .attr("fill", d => d.ideology.color)
                .attr("fill-opacity", 0.6)
                .on("click", function(e, d) {
                    d3.selectAll("#svg-setup .country").classed("selected", false);
                    d3.select(this).classed("selected", true);
                    updateSetupPanel(d);
                });

            svg.call(d3.zoom().scaleExtent([1, 8]).on("zoom", (e) => g.attr("transform", e.transform)));
        }

        function updateSetupPanel(d) {
            selected = d;
            document.getElementById('no-selection').classList.add('hidden');
            document.getElementById('country-preview').classList.remove('hidden');
            
            document.getElementById('p-tag').innerText = d.id || '???';
            document.getElementById('p-name').innerText = d.name;
            document.getElementById('p-army').innerText = d.army;
            document.getElementById('p-econ').innerText = (d.econ / 10).toFixed(1) + "B";
            document.getElementById('p-ideo').innerHTML = `<span class="text-2xl">${d.ideology.icon}</span><span class="font-bold text-sm">${d.ideology.name}</span>`;
        }

        function startGame() {
            player = selected;
            document.getElementById('setup-screen').classList.add('hidden');
            document.getElementById('game-ui').classList.remove('hidden');
            
            renderMainMap();
            renderTechTree();
            addLog(`–ù–∞—Ü–∏—è ${player.name} –ø—Ä–∏–≤–µ–¥–µ–Ω–∞ –≤ –±–æ–µ–≤—É—é –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å.`, "text-emerald-400 font-bold");
            
            // Loop
            setInterval(gameTick, 1000);
        }

        // --- MAP RENDERING ---

        function renderMainMap() {
            const svg = d3.select("#svg-main");
            svg.selectAll("*").remove();
            const g = svg.append("g");

            g.selectAll("path")
                .data(countries)
                .enter()
                .append("path")
                .attr("d", path)
                .attr("class", d => `country ${d.id === player.id ? 'player-country' : ''}`)
                .attr("fill", d => d.isDestroyed ? "#111" : d.ideology.color)
                .attr("fill-opacity", 0.7)
                .on("click", (e, d) => showCountryInfo(d));

            svg.call(d3.zoom().scaleExtent([1, 15]).on("zoom", (e) => g.attr("transform", e.transform)));
        }

        function showCountryInfo(d) {
            selected = d;
            document.getElementById('info-placeholder').classList.add('hidden');
            const box = document.getElementById('info-box');
            box.classList.remove('hidden');

            document.getElementById('info-name').innerText = d.name;
            document.getElementById('info-army').innerText = d.army;
            document.getElementById('info-stab').innerText = d.stability + "%";
            
            const badge = document.getElementById('info-ideo-badge');
            badge.innerText = d.ideology.name;
            badge.style.color = d.ideology.color;
            badge.style.borderColor = d.ideology.color + "44";

            // UI Actions
            const actions = document.getElementById('player-actions');
            actions.style.display = d.id === player.id ? 'none' : 'grid';

            // Nuclear check
            const nukeBtn = document.getElementById('nuke-btn');
            nukeBtn.classList.toggle('hidden', !techs.find(t => t.id === 'atom_2').unlocked || resources.nukes <= 0);
        }

        // --- GAME LOGIC ---

        function gameTick() {
            if (gameSpeed === 0) return;

            const ticks = gameSpeed === 1 ? 1 : 5;
            for(let i=0; i < ticks; i++) {
                // Update Date
                gameDate.setDate(gameDate.getDate() + 1);
                
                // Income
                resources.gold += (player.econ / 100);
                resources.pp += 0.1;
                resources.techPoints += 0.5;

                // AI Events
                if (Math.random() < 0.01) processRandomEvent();
            }

            updateHUD();
        }

        function updateHUD() {
            document.getElementById('res-gold').innerText = Math.floor(resources.gold);
            document.getElementById('res-oil').innerText = Math.floor(resources.oil);
            document.getElementById('res-pp').innerText = Math.floor(resources.pp);
            document.getElementById('res-nukes').innerText = resources.nukes;
            document.getElementById('game-date').innerText = gameDate.toLocaleDateString('en-GB', {day:'2-digit', month:'short', year:'numeric'}).toUpperCase();
            
            // Tech points check for red indicator
            const techBtn = document.getElementById('btn-tech');
            const affordableTech = techs.some(t => !t.unlocked && resources.techPoints >= t.cost);
            techBtn.style.color = affordableTech ? '#10b981' : '';
        }

        function processRandomEvent() {
            const evs = [
                { t: "–ó–∞–±–∞—Å—Ç–æ–≤–∫–∞ —Ä–∞–±–æ—á–∏—Ö", d: "–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø–∞–¥–∞–µ—Ç –Ω–∞ 5%", action: () => player.stability -= 5 },
                { t: "–î–∏–ø–ª–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ä—ã–≤", d: "–ú–∏—Ä–æ–≤–æ–µ –≤–ª–∏—è–Ω–∏–µ +10", action: () => resources.pp += 10 },
                { t: "–ù–æ–≤–æ–µ –º–µ—Å—Ç–æ—Ä–æ–∂–¥–µ–Ω–∏–µ", d: "–ó–∞–ø–∞—Å—ã –Ω–µ—Ñ—Ç–∏ –ø–æ–ø–æ–ª–Ω–µ–Ω—ã", action: () => resources.oil += 50 }
            ];
            const e = evs[Math.floor(Math.random() * evs.length)];
            e.action();
            
            const ticker = document.getElementById('news-ticker');
            ticker.classList.remove('hidden');
            document.getElementById('news-text').innerText = `${e.t}: ${e.d}`;
            setTimeout(() => ticker.classList.add('hidden'), 5000);
        }

        // --- ACTIONS ---

        function actionWar() {
            if (resources.pp < 20) {
                addLog("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–ª–∏—è–Ω–∏—è –¥–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤–æ–π–Ω—ã!", "text-red-500");
                return;
            }
            resources.pp -= 20;
            selected.atWar = true;
            addLog(`–í–Ω–∏–º–∞–Ω–∏–µ! –ú—ã –æ–±—ä—è–≤–∏–ª–∏ –≤–æ–π–Ω—É –Ω–∞—Ü–∏–∏ ${selected.name}!`, "text-red-500 font-bold");
            
            // –°–∏–º—É–ª—è—Ü–∏—è –±–∏—Ç–≤—ã (—É–ø—Ä–æ—â–µ–Ω–Ω–æ)
            setTimeout(() => {
                if (player.army > selected.army) {
                    addLog(`–ü–æ–±–µ–¥–∞! ${selected.name} –∫–∞–ø–∏—Ç—É–ª–∏—Ä–æ–≤–∞–ª–∞.`, "text-emerald-400");
                    selected.ideology = player.ideology;
                    selected.atWar = false;
                    renderMainMap();
                } else {
                    addLog(`–ü–æ—Ä–∞–∂–µ–Ω–∏–µ! –ù–∞—à–∏ –≤–æ–π—Å–∫–∞ –æ—Ç—Å—Ç—É–ø–∏–ª–∏ –æ—Ç –≥—Ä–∞–Ω–∏—Ü ${selected.name}.`, "text-red-400");
                    player.army -= 50;
                }
            }, 3000);
        }

        function actionNuke() {
            if (resources.nukes <= 0) return;
            
            resources.nukes--;
            isNuclearWar = true;
            
            // FX
            const fx = document.getElementById('nuke-effect');
            fx.style.opacity = "1";
            document.body.classList.add('nuke-active');
            
            setTimeout(() => {
                fx.style.opacity = "0";
                document.body.classList.remove('nuke-active');
                
                selected.isDestroyed = true;
                selected.army = 0;
                selected.stability = 0;
                
                addLog(`–Ø–î–ï–†–ù–´–ô –£–î–ê–† –ü–û ${selected.name.toUpperCase()}. –¶–ï–õ–¨ –£–ù–ò–ß–¢–û–ñ–ï–ù–ê.`, "text-yellow-500 font-black");
                
                // World reaction
                countries.forEach(c => {
                    if (c.id !== player.id) c.relations -= 100;
                });
                
                renderMainMap();
            }, 200);
        }

        function renderTechTree() {
            const container = document.getElementById('tech-list');
            container.innerHTML = '';
            
            techs.forEach(t => {
                const node = document.createElement('div');
                node.className = `tech-node p-4 rounded-2xl flex justify-between items-center ${t.unlocked ? 'unlocked' : ''}`;
                node.innerHTML = `
                    <div>
                        <div class="text-xs font-black uppercase">${t.name}</div>
                        <div class="text-[9px] text-slate-500">${t.desc}</div>
                    </div>
                    <button onclick="buyTech('${t.id}')" ${t.unlocked ? 'disabled' : ''} class="px-3 py-1 bg-white/5 hover:bg-emerald-600 rounded-lg text-[10px] font-bold transition-all">
                        ${t.unlocked ? '–ò–ó–£–ß–ï–ù–û' : t.cost + ' RP'}
                    </button>
                `;
                container.appendChild(node);
            });
        }

        function buyTech(id) {
            const t = techs.find(x => x.id === id);
            if (resources.techPoints >= t.cost) {
                resources.techPoints -= t.cost;
                t.unlocked = true;
                addLog(`–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è "${t.name}" —É—Å–ø–µ—à–Ω–æ –≤–Ω–µ–¥—Ä–µ–Ω–∞.`);
                
                if (t.id === 'atom_1') {
                    document.getElementById('nuke-counter-container').classList.remove('hidden');
                }
                if (t.id === 'atom_2') {
                    // Start producing nukes
                    setInterval(() => { if(gameSpeed > 0) resources.nukes++ }, 30000);
                }
                
                renderTechTree();
                updateHUD();
                if(selected) showCountryInfo(selected);
            }
        }

        // --- UI HELPERS ---

        function setTab(t) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-' + t).classList.add('active');
            
            document.getElementById('tab-content-diplo').classList.add('hidden');
            document.getElementById('tab-content-tech').classList.add('hidden');
            document.getElementById('tab-content-stats').classList.add('hidden');
            
            document.getElementById('tab-content-' + t).classList.remove('hidden');
        }

        function setSpeed(s) {
            gameSpeed = s;
            document.getElementById('game-speed-label').innerText = s === 0 ? "PAUSED" : s === 1 ? "NORMAL" : "FAST x5";
        }

        function addLog(msg, color = "text-slate-400") {
            const log = document.getElementById('game-logs');
            const entry = document.createElement('div');
            entry.className = `log-entry ${color}`;
            entry.innerHTML = `<span class="opacity-30 mr-2">${gameDate.toLocaleDateString()}</span> ${msg}`;
            log.prepend(entry);
        }

        window.onload = init;
    </script>
</body>
</html>
